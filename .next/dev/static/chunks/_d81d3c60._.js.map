{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/components/map-wrapper.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport dynamic from \"next/dynamic\"\r\nimport type { LocationData } from \"@/lib/types\"\r\nimport type { Map as LeafletMap } from \"leaflet\"\r\n\r\ninterface MapProps {\r\n  locations: LocationData[]\r\n  plannedRoute?: [number, number][]\r\n  onMapReady?: (map: LeafletMap) => void\r\n  userLocation?: { lat: number; lng: number } | null\r\n}\r\n\r\nconst Map = dynamic(() => import(\"@/components/map\"), {\r\n  ssr: false,\r\n  loading: () => (\r\n    <div className=\"w-full h-full flex items-center justify-center bg-gray-100\">\r\n      <div className=\"text-gray-600\">地図を読み込んでいます...</div>\r\n    </div>\r\n  ),\r\n})\r\n\r\nexport function MapWrapper(props: MapProps) {\r\n  return <Map {...props} />\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;AAFA;;;AAaA,MAAM,MAAM,IAAA,6KAAO,EAAC;;;;;;IAClB,KAAK;IACL,SAAS,kBACP,6LAAC;YAAI,WAAU;sBACb,cAAA,6LAAC;gBAAI,WAAU;0BAAgB;;;;;;;;;;;;KAJ/B;AASC,SAAS,WAAW,KAAe;IACxC,qBAAO,6LAAC;QAAK,GAAG,KAAK;;;;;;AACvB;MAFgB","debugId":null}},
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/components/zoom-controls.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport type { Map as LeafletMap } from \"leaflet\"\r\n\r\ninterface ZoomControlsProps {\r\n  map: LeafletMap | null\r\n  onUserLocation: () => void\r\n  onVehicleLocation: () => void\r\n}\r\n\r\nexport function ZoomControls({ map, onUserLocation, onVehicleLocation }: ZoomControlsProps) {\r\n  const handleZoomIn = () => {\r\n    if (map) {\r\n      map.zoomIn()\r\n    }\r\n  }\r\n\r\n  const handleZoomOut = () => {\r\n    if (map) {\r\n      map.zoomOut()\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div style={{ display: \"flex\", flexDirection: \"column\", gap: \"12px\" }}>\r\n      {/* 拡大ボタン */}\r\n      <button\r\n        onClick={handleZoomIn}\r\n        style={{\r\n          width: \"48px\",\r\n          height: \"48px\",\r\n          borderRadius: \"50%\",\r\n          background: \"rgba(255, 255, 255, 0.95)\",\r\n          boxShadow: \"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)\",\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          justifyContent: \"center\",\r\n          border: \"none\",\r\n          cursor: \"pointer\",\r\n        }}\r\n        aria-label=\"拡大\"\r\n      >\r\n        <svg\r\n          width=\"24\"\r\n          height=\"24\"\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          stroke=\"#364153\"\r\n          strokeWidth=\"2\"\r\n          strokeLinecap=\"round\"\r\n          strokeLinejoin=\"round\"\r\n        >\r\n          <circle cx=\"11\" cy=\"11\" r=\"8\" />\r\n          <path d=\"M21 21l-4.35-4.35\" />\r\n          <line x1=\"11\" y1=\"8\" x2=\"11\" y2=\"14\" />\r\n          <line x1=\"8\" y1=\"11\" x2=\"14\" y2=\"11\" />\r\n        </svg>\r\n      </button>\r\n\r\n      {/* 縮小ボタン */}\r\n      <button\r\n        onClick={handleZoomOut}\r\n        style={{\r\n          width: \"48px\",\r\n          height: \"48px\",\r\n          borderRadius: \"50%\",\r\n          background: \"rgba(255, 255, 255, 0.95)\",\r\n          boxShadow: \"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)\",\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          justifyContent: \"center\",\r\n          border: \"none\",\r\n          cursor: \"pointer\",\r\n        }}\r\n        aria-label=\"縮小\"\r\n      >\r\n        <svg\r\n          width=\"24\"\r\n          height=\"24\"\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          stroke=\"#364153\"\r\n          strokeWidth=\"2\"\r\n          strokeLinecap=\"round\"\r\n          strokeLinejoin=\"round\"\r\n        >\r\n          <circle cx=\"11\" cy=\"11\" r=\"8\" />\r\n          <path d=\"M21 21l-4.35-4.35\" />\r\n          <line x1=\"8\" y1=\"11\" x2=\"14\" y2=\"11\" />\r\n        </svg>\r\n      </button>\r\n\r\n      {/* ユーザー位置ボタン（青） */}\r\n      <button\r\n        onClick={onUserLocation}\r\n        style={{\r\n          width: \"48px\",\r\n          height: \"48px\",\r\n          borderRadius: \"50%\",\r\n          background: \"linear-gradient(135deg, #2B7FFF 0%, #51A2FF 100%)\",\r\n          boxShadow: \"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)\",\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          justifyContent: \"center\",\r\n          border: \"none\",\r\n          cursor: \"pointer\",\r\n        }}\r\n        aria-label=\"現在位置\"\r\n      >\r\n        <svg\r\n          width=\"24\"\r\n          height=\"24\"\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          stroke=\"white\"\r\n          strokeWidth=\"2\"\r\n          strokeLinecap=\"round\"\r\n          strokeLinejoin=\"round\"\r\n        >\r\n          <polygon points=\"3 11 22 2 13 21 11 13 3 11\" />\r\n        </svg>\r\n      </button>\r\n\r\n      {/* 車両位置ボタン（緑） */}\r\n      <button\r\n        onClick={onVehicleLocation}\r\n        style={{\r\n          width: \"48px\",\r\n          height: \"48px\",\r\n          borderRadius: \"50%\",\r\n          background: \"linear-gradient(135deg, #00C950 0%, #00D492 100%)\",\r\n          boxShadow: \"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)\",\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          justifyContent: \"center\",\r\n          border: \"none\",\r\n          cursor: \"pointer\",\r\n        }}\r\n        aria-label=\"車両位置\"\r\n      >\r\n        <svg\r\n          width=\"24\"\r\n          height=\"24\"\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          stroke=\"white\"\r\n          strokeWidth=\"2\"\r\n          strokeLinecap=\"round\"\r\n          strokeLinejoin=\"round\"\r\n        >\r\n          <path d=\"M5 17h-2v-6l2-5h9l4 5v6h-2\" />\r\n          <circle cx=\"7\" cy=\"17\" r=\"2\" />\r\n          <path d=\"M9 17h6\" />\r\n          <circle cx=\"17\" cy=\"17\" r=\"2\" />\r\n          <path d=\"M16 5l3 5\" />\r\n          <path d=\"M5 11h11\" />\r\n        </svg>\r\n      </button>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;AAUO,SAAS,aAAa,EAAE,GAAG,EAAE,cAAc,EAAE,iBAAiB,EAAqB;IACxF,MAAM,eAAe;QACnB,IAAI,KAAK;YACP,IAAI,MAAM;QACZ;IACF;IAEA,MAAM,gBAAgB;QACpB,IAAI,KAAK;YACP,IAAI,OAAO;QACb;IACF;IAEA,qBACE,6LAAC;QAAI,OAAO;YAAE,SAAS;YAAQ,eAAe;YAAU,KAAK;QAAO;;0BAElE,6LAAC;gBACC,SAAS;gBACT,OAAO;oBACL,OAAO;oBACP,QAAQ;oBACR,cAAc;oBACd,YAAY;oBACZ,WAAW;oBACX,SAAS;oBACT,YAAY;oBACZ,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA,cAAW;0BAEX,cAAA,6LAAC;oBACC,OAAM;oBACN,QAAO;oBACP,SAAQ;oBACR,MAAK;oBACL,QAAO;oBACP,aAAY;oBACZ,eAAc;oBACd,gBAAe;;sCAEf,6LAAC;4BAAO,IAAG;4BAAK,IAAG;4BAAK,GAAE;;;;;;sCAC1B,6LAAC;4BAAK,GAAE;;;;;;sCACR,6LAAC;4BAAK,IAAG;4BAAK,IAAG;4BAAI,IAAG;4BAAK,IAAG;;;;;;sCAChC,6LAAC;4BAAK,IAAG;4BAAI,IAAG;4BAAK,IAAG;4BAAK,IAAG;;;;;;;;;;;;;;;;;0BAKpC,6LAAC;gBACC,SAAS;gBACT,OAAO;oBACL,OAAO;oBACP,QAAQ;oBACR,cAAc;oBACd,YAAY;oBACZ,WAAW;oBACX,SAAS;oBACT,YAAY;oBACZ,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA,cAAW;0BAEX,cAAA,6LAAC;oBACC,OAAM;oBACN,QAAO;oBACP,SAAQ;oBACR,MAAK;oBACL,QAAO;oBACP,aAAY;oBACZ,eAAc;oBACd,gBAAe;;sCAEf,6LAAC;4BAAO,IAAG;4BAAK,IAAG;4BAAK,GAAE;;;;;;sCAC1B,6LAAC;4BAAK,GAAE;;;;;;sCACR,6LAAC;4BAAK,IAAG;4BAAI,IAAG;4BAAK,IAAG;4BAAK,IAAG;;;;;;;;;;;;;;;;;0BAKpC,6LAAC;gBACC,SAAS;gBACT,OAAO;oBACL,OAAO;oBACP,QAAQ;oBACR,cAAc;oBACd,YAAY;oBACZ,WAAW;oBACX,SAAS;oBACT,YAAY;oBACZ,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA,cAAW;0BAEX,cAAA,6LAAC;oBACC,OAAM;oBACN,QAAO;oBACP,SAAQ;oBACR,MAAK;oBACL,QAAO;oBACP,aAAY;oBACZ,eAAc;oBACd,gBAAe;8BAEf,cAAA,6LAAC;wBAAQ,QAAO;;;;;;;;;;;;;;;;0BAKpB,6LAAC;gBACC,SAAS;gBACT,OAAO;oBACL,OAAO;oBACP,QAAQ;oBACR,cAAc;oBACd,YAAY;oBACZ,WAAW;oBACX,SAAS;oBACT,YAAY;oBACZ,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA,cAAW;0BAEX,cAAA,6LAAC;oBACC,OAAM;oBACN,QAAO;oBACP,SAAQ;oBACR,MAAK;oBACL,QAAO;oBACP,aAAY;oBACZ,eAAc;oBACd,gBAAe;;sCAEf,6LAAC;4BAAK,GAAE;;;;;;sCACR,6LAAC;4BAAO,IAAG;4BAAI,IAAG;4BAAK,GAAE;;;;;;sCACzB,6LAAC;4BAAK,GAAE;;;;;;sCACR,6LAAC;4BAAO,IAAG;4BAAK,IAAG;4BAAK,GAAE;;;;;;sCAC1B,6LAAC;4BAAK,GAAE;;;;;;sCACR,6LAAC;4BAAK,GAAE;;;;;;;;;;;;;;;;;;;;;;;AAKlB;KAtJgB","debugId":null}},
    {"offset": {"line": 357, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/components/passenger-count.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect } from \"react\"\r\n\r\ninterface PassengerCountProps {\r\n  count?: number\r\n}\r\n\r\nexport function PassengerCount({ count }: PassengerCountProps) {\r\n  useEffect(() => {\r\n    console.log(\"[v0] PassengerCount mounted - should have white background\")\r\n  }, [])\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        background: \"rgba(255, 255, 255, 0.95)\",\r\n        borderRadius: \"16px\",\r\n        boxShadow: \"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)\",\r\n        padding: \"12px 16px\",\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n        gap: \"12px\",\r\n      }}\r\n    >\r\n      <svg\r\n        width=\"24\"\r\n        height=\"24\"\r\n        viewBox=\"0 0 24 24\"\r\n        fill=\"none\"\r\n        stroke=\"#364153\"\r\n        strokeWidth=\"2\"\r\n        strokeLinecap=\"round\"\r\n        strokeLinejoin=\"round\"\r\n      >\r\n        <path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\" />\r\n        <circle cx=\"9\" cy=\"7\" r=\"4\" />\r\n        <path d=\"M23 21v-2a4 4 0 0 0-3-3.87\" />\r\n        <path d=\"M16 3.13a4 4 0 0 1 0 7.75\" />\r\n      </svg>\r\n      <div>\r\n        <div style={{ fontSize: \"12px\", color: \"#4B5563\" }}>現在の混雑状況</div>\r\n        <div style={{ fontSize: \"18px\", fontWeight: \"bold\", color: \"#111827\" }}>\r\n          {count !== undefined ? `${count}人` : \"取得中...\"}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;;AAFA;;AAQO,SAAS,eAAe,EAAE,KAAK,EAAuB;;IAC3D,IAAA,0KAAS;oCAAC;YACR,QAAQ,GAAG,CAAC;QACd;mCAAG,EAAE;IAEL,qBACE,6LAAC;QACC,OAAO;YACL,YAAY;YACZ,cAAc;YACd,WAAW;YACX,SAAS;YACT,SAAS;YACT,YAAY;YACZ,KAAK;QACP;;0BAEA,6LAAC;gBACC,OAAM;gBACN,QAAO;gBACP,SAAQ;gBACR,MAAK;gBACL,QAAO;gBACP,aAAY;gBACZ,eAAc;gBACd,gBAAe;;kCAEf,6LAAC;wBAAK,GAAE;;;;;;kCACR,6LAAC;wBAAO,IAAG;wBAAI,IAAG;wBAAI,GAAE;;;;;;kCACxB,6LAAC;wBAAK,GAAE;;;;;;kCACR,6LAAC;wBAAK,GAAE;;;;;;;;;;;;0BAEV,6LAAC;;kCACC,6LAAC;wBAAI,OAAO;4BAAE,UAAU;4BAAQ,OAAO;wBAAU;kCAAG;;;;;;kCACpD,6LAAC;wBAAI,OAAO;4BAAE,UAAU;4BAAQ,YAAY;4BAAQ,OAAO;wBAAU;kCAClE,UAAU,YAAY,GAAG,MAAM,CAAC,CAAC,GAAG;;;;;;;;;;;;;;;;;;AAK/C;GAxCgB;KAAA","debugId":null}},
    {"offset": {"line": 480, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/components/route-info.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect } from \"react\"\r\n\r\ninterface RouteInfoProps {\r\n  routeName: string\r\n  startTime?: string\r\n  endTime?: string\r\n}\r\n\r\nexport function RouteInfo({ routeName, startTime, endTime }: RouteInfoProps) {\r\n  useEffect(() => {\r\n    console.log(\"[v0] RouteInfo mounted - should have white background\")\r\n  }, [])\r\n\r\n  return (\r\n    <div style={{ width: \"100%\" }}>\r\n      <div\r\n        style={{\r\n          background: \"rgba(255, 255, 255, 0.95)\",\r\n          borderRadius: \"24px 24px 0 0\",\r\n          boxShadow: \"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)\",\r\n          padding: \"16px 24px\",\r\n        }}\r\n      >\r\n        <div style={{ display: \"flex\", alignItems: \"center\", justifyContent: \"space-between\" }}>\r\n          <div>\r\n            <div style={{ fontSize: \"20px\", fontWeight: \"bold\", color: \"#111827\" }}>{routeName}</div>\r\n            {startTime && endTime && (\r\n              <div style={{ fontSize: \"14px\", color: \"#4B5563\", marginTop: \"4px\" }}>\r\n                【{startTime}~{endTime}】\r\n              </div>\r\n            )}\r\n          </div>\r\n          <div\r\n            style={{\r\n              width: \"12px\",\r\n              height: \"12px\",\r\n              borderRadius: \"50%\",\r\n              background: \"#10B981\",\r\n              animation: \"pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite\",\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;;AAFA;;AAUO,SAAS,UAAU,EAAE,SAAS,EAAE,SAAS,EAAE,OAAO,EAAkB;;IACzE,IAAA,0KAAS;+BAAC;YACR,QAAQ,GAAG,CAAC;QACd;8BAAG,EAAE;IAEL,qBACE,6LAAC;QAAI,OAAO;YAAE,OAAO;QAAO;kBAC1B,cAAA,6LAAC;YACC,OAAO;gBACL,YAAY;gBACZ,cAAc;gBACd,WAAW;gBACX,SAAS;YACX;sBAEA,cAAA,6LAAC;gBAAI,OAAO;oBAAE,SAAS;oBAAQ,YAAY;oBAAU,gBAAgB;gBAAgB;;kCACnF,6LAAC;;0CACC,6LAAC;gCAAI,OAAO;oCAAE,UAAU;oCAAQ,YAAY;oCAAQ,OAAO;gCAAU;0CAAI;;;;;;4BACxE,aAAa,yBACZ,6LAAC;gCAAI,OAAO;oCAAE,UAAU;oCAAQ,OAAO;oCAAW,WAAW;gCAAM;;oCAAG;oCAClE;oCAAU;oCAAE;oCAAQ;;;;;;;;;;;;;kCAI5B,6LAAC;wBACC,OAAO;4BACL,OAAO;4BACP,QAAQ;4BACR,cAAc;4BACd,YAAY;4BACZ,WAAW;wBACb;;;;;;;;;;;;;;;;;;;;;;AAMZ;GArCgB;KAAA","debugId":null}},
    {"offset": {"line": 594, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/lib/firebase.ts"],"sourcesContent":["import { initializeApp, getApps } from \"firebase/app\"\r\nimport {\r\n  getFirestore,\r\n  collection,\r\n  query,\r\n  orderBy,\r\n  onSnapshot,\r\n  Timestamp,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  setDoc,\r\n} from \"firebase/firestore\"\r\nimport type { LocationData, SavedRoute, ActiveRouteSettings } from \"./types\"\r\nimport { simplifyRoute, removeDuplicatePoints } from \"./utils/simplify-route\"\r\n\r\nconst firebaseConfig = {\r\n  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\r\n  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\r\n  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\r\n  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\r\n  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\r\n  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\r\n  measurementId: process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID,\r\n}\r\n\r\n// Initialize Firebase (singleton pattern)\r\nconst app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0]\r\nconst db = getFirestore(app)\r\n\r\nexport { app, db }\r\n\r\nexport function getRealtimeLocations(\r\n  collectionName: string,\r\n  callback: (locations: LocationData[]) => void,\r\n): () => void {\r\n  const locationsRef = collection(db, collectionName)\r\n  const q = query(locationsRef, orderBy(\"timestamp\", \"asc\"))\r\n\r\n  const unsubscribe = onSnapshot(\r\n    q,\r\n    (snapshot) => {\r\n      const locations: LocationData[] = []\r\n      snapshot.forEach((doc) => {\r\n        const data = doc.data()\r\n        locations.push({\r\n          id: doc.id,\r\n          latitude: data.latitude,\r\n          longitude: data.longitude,\r\n          timestamp: data.timestamp instanceof Timestamp ? data.timestamp.toDate() : new Date(data.timestamp),\r\n          speed: data.speed,\r\n          accuracy: data.accuracy,\r\n        })\r\n      })\r\n      callback(locations)\r\n    },\r\n    (error) => {\r\n      console.error(\"[v0] Firestore error:\", error)\r\n    },\r\n  )\r\n\r\n  return unsubscribe\r\n}\r\n\r\nexport async function getActiveRoute(): Promise<string | null> {\r\n  try {\r\n    const docRef = doc(db, \"settings\", \"active-route\")\r\n    const docSnap = await getDoc(docRef)\r\n\r\n    if (docSnap.exists()) {\r\n      const data = docSnap.data() as ActiveRouteSettings\r\n      return data.routeId\r\n    }\r\n    return null\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting active route:\", error)\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function getSavedRoute(routeId: string): Promise<SavedRoute | null> {\r\n  try {\r\n    const docRef = doc(db, \"saved-routes\", routeId)\r\n    const docSnap = await getDoc(docRef)\r\n\r\n    if (docSnap.exists()) {\r\n      return docSnap.data() as SavedRoute\r\n    }\r\n    return null\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting saved route:\", error)\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function getDateCollections(): Promise<string[]> {\r\n  try {\r\n    const docRef = doc(db, \"date-index\", \"dates\")\r\n    const docSnap = await getDoc(docRef)\r\n\r\n    if (docSnap.exists()) {\r\n      const data = docSnap.data()\r\n      const dateList = data.dateList as string[]\r\n\r\n      // Sort by date descending (newest first)\r\n      return dateList.sort((a, b) => {\r\n        const dateA = a.split(\"_\")[0]\r\n        const dateB = b.split(\"_\")[0]\r\n        return dateB.localeCompare(dateA)\r\n      })\r\n    }\r\n\r\n    return []\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting date index:\", error)\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function getAllLocationsFromCollection(collectionName: string): Promise<LocationData[]> {\r\n  try {\r\n    const locationsRef = collection(db, collectionName)\r\n    const q = query(locationsRef, orderBy(\"timestamp\", \"asc\"))\r\n    const snapshot = await getDocs(q)\r\n\r\n    const locations: LocationData[] = []\r\n    snapshot.forEach((doc) => {\r\n      const data = doc.data()\r\n      locations.push({\r\n        id: doc.id,\r\n        latitude: data.latitude,\r\n        longitude: data.longitude,\r\n        timestamp: data.timestamp instanceof Timestamp ? data.timestamp.toDate() : new Date(data.timestamp),\r\n        speed: data.speed,\r\n        accuracy: data.accuracy,\r\n      })\r\n    })\r\n\r\n    return locations\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting locations from collection:\", error)\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function saveRouteAsActive(routeId: string, locations: LocationData[]): Promise<boolean> {\r\n  try {\r\n    const points = locations.map((loc) => ({\r\n      lat: loc.latitude,\r\n      lng: loc.longitude,\r\n      timestamp: loc.timestamp instanceof Date ? loc.timestamp.toISOString() : loc.timestamp,\r\n    }))\r\n\r\n    // Remove duplicate points (GPS noise)\r\n    const deduplicated = removeDuplicatePoints(points)\r\n    console.log(`[v0] Points: ${points.length} → ${deduplicated.length} (after deduplication)`)\r\n\r\n    // Simplify route using Douglas-Peucker algorithm\r\n    const simplified = simplifyRoute(deduplicated, 0.0001) // tolerance: 約10メートル\r\n    console.log(`[v0] Points: ${deduplicated.length} → ${simplified.length} (after simplification)`)\r\n\r\n    // Save route data to /saved-routes/{routeId}\r\n    const routeDocRef = doc(db, \"saved-routes\", routeId)\r\n    const savedRoute: SavedRoute = {\r\n      name: `${routeId}のルート`,\r\n      createdAt: new Date().toISOString(),\r\n      points: simplified, // Use simplified points\r\n    }\r\n    await setDoc(routeDocRef, savedRoute)\r\n\r\n    // Update /settings/active-route to point to this route\r\n    const settingsDocRef = doc(db, \"settings\", \"active-route\")\r\n    const activeSettings: ActiveRouteSettings = {\r\n      routeId: routeId,\r\n      updatedAt: new Date().toISOString(),\r\n    }\r\n    await setDoc(settingsDocRef, activeSettings)\r\n\r\n    return true\r\n  } catch (error) {\r\n    console.error(\"[v0] Error saving route:\", error)\r\n    return false\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 772, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/app/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useState, useCallback } from \"react\"\r\nimport { MapWrapper } from \"@/components/map-wrapper\"\r\nimport { ZoomControls } from \"@/components/zoom-controls\"\r\nimport { PassengerCount } from \"@/components/passenger-count\"\r\nimport { RouteInfo } from \"@/components/route-info\"\r\nimport { getRealtimeLocations, getActiveRoute, getSavedRoute } from \"@/lib/firebase\"\r\nimport type { LocationData } from \"@/lib/types\"\r\nimport type { Map as LeafletMap } from \"leaflet\"\r\n\r\nexport default function Home() {\r\n  const [locations, setLocations] = useState<LocationData[]>([])\r\n  const [map, setMap] = useState<LeafletMap | null>(null)\r\n  const [collectionName, setCollectionName] = useState<string>(\"\")\r\n  const [userLocation, setUserLocation] = useState<{ lat: number; lng: number } | null>(null)\r\n  const [plannedRoute, setPlannedRoute] = useState<[number, number][]>([])\r\n  const [routeName, setRouteName] = useState<string>(\"ルート走行中\")\r\n\r\n  // 今日の日付からコレクション名を生成\r\n  useEffect(() => {\r\n    const today = new Date()\r\n    const year = today.getFullYear()\r\n    const month = String(today.getMonth() + 1).padStart(2, \"0\")\r\n    const day = String(today.getDate()).padStart(2, \"0\")\r\n    const todayCollection = `${year}${month}${day}`\r\n    setCollectionName(todayCollection)\r\n  }, [])\r\n\r\n  // Firestoreからリアルタイムでデータを取得\r\n  useEffect(() => {\r\n    if (!collectionName) return\r\n\r\n    console.log(\"[v0] Subscribing to collection:\", collectionName)\r\n\r\n    const unsubscribe = getRealtimeLocations(collectionName, (newLocations) => {\r\n      console.log(\"[v0] Received locations:\", newLocations.length)\r\n      setLocations(newLocations)\r\n    })\r\n\r\n    return () => {\r\n      console.log(\"[v0] Unsubscribing from collection\")\r\n      unsubscribe()\r\n    }\r\n  }, [collectionName])\r\n\r\n  useEffect(() => {\r\n    if (\"geolocation\" in navigator) {\r\n      navigator.geolocation.getCurrentPosition(\r\n        (position) => {\r\n          setUserLocation({\r\n            lat: position.coords.latitude,\r\n            lng: position.coords.longitude,\r\n          })\r\n          console.log(\"[v0] User location obtained:\", position.coords)\r\n        },\r\n        (error) => {\r\n          console.error(\"[v0] Geolocation error:\", error)\r\n        },\r\n      )\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    const loadActiveRoute = async () => {\r\n      console.log(\"[v0] Loading active route...\")\r\n      const routeId = await getActiveRoute()\r\n\r\n      if (routeId) {\r\n        console.log(\"[v0] Active route ID:\", routeId)\r\n        const savedRoute = await getSavedRoute(routeId)\r\n\r\n        if (savedRoute) {\r\n          console.log(\"[v0] Loaded saved route:\", savedRoute.name, \"with\", savedRoute.points.length, \"points\")\r\n          const routeCoords: [number, number][] = savedRoute.points.map((p) => [p.lat, p.lng])\r\n          setPlannedRoute(routeCoords)\r\n          setRouteName(savedRoute.name)\r\n        } else {\r\n          console.log(\"[v0] No saved route data found for ID:\", routeId)\r\n        }\r\n      } else {\r\n        console.log(\"[v0] No active route set\")\r\n      }\r\n    }\r\n\r\n    loadActiveRoute()\r\n  }, [])\r\n\r\n  // ユーザーの現在位置を中心に\r\n  const handleUserLocation = useCallback(() => {\r\n    if (!map) return\r\n\r\n    if (userLocation) {\r\n      map.setView([userLocation.lat, userLocation.lng], 16)\r\n    } else {\r\n      if (\"geolocation\" in navigator) {\r\n        navigator.geolocation.getCurrentPosition(\r\n          (position) => {\r\n            const newLocation = {\r\n              lat: position.coords.latitude,\r\n              lng: position.coords.longitude,\r\n            }\r\n            setUserLocation(newLocation)\r\n            map.setView([newLocation.lat, newLocation.lng], 16)\r\n          },\r\n          (error) => {\r\n            console.error(\"[v0] Geolocation error:\", error)\r\n            alert(\"位置情報の取得に失敗しました\")\r\n          },\r\n        )\r\n      } else {\r\n        alert(\"このブラウザは位置情報に対応していません\")\r\n      }\r\n    }\r\n  }, [map, userLocation])\r\n\r\n  // 車両の現在位置を中心に\r\n  const handleVehicleLocation = useCallback(() => {\r\n    if (!map || locations.length === 0) {\r\n      console.log(\"[v0] Vehicle location not available\")\r\n      return\r\n    }\r\n\r\n    const latestLocation = locations[locations.length - 1]\r\n    console.log(\"[v0] Centering on vehicle:\", latestLocation)\r\n    map.setView([latestLocation.latitude, latestLocation.longitude], 16)\r\n  }, [map, locations])\r\n\r\n  return (\r\n    <main className=\"w-full h-screen relative overflow-hidden\">\r\n      <div className=\"absolute inset-0\" style={{ zIndex: 1 }}>\r\n        <MapWrapper locations={locations} onMapReady={setMap} userLocation={userLocation} plannedRoute={plannedRoute} />\r\n      </div>\r\n\r\n      <div\r\n        style={{\r\n          position: \"fixed\",\r\n          top: \"16px\",\r\n          left: \"16px\",\r\n          zIndex: 9999,\r\n          pointerEvents: \"auto\",\r\n        }}\r\n      >\r\n        <PassengerCount />\r\n      </div>\r\n\r\n      <div\r\n        style={{\r\n          position: \"fixed\",\r\n          top: \"16px\",\r\n          right: \"16px\",\r\n          zIndex: 9999,\r\n          pointerEvents: \"auto\",\r\n        }}\r\n      >\r\n        <ZoomControls map={map} onUserLocation={handleUserLocation} onVehicleLocation={handleVehicleLocation} />\r\n      </div>\r\n\r\n      <div\r\n        style={{\r\n          position: \"fixed\",\r\n          bottom: 0,\r\n          left: 0,\r\n          right: 0,\r\n          zIndex: 9999,\r\n          pointerEvents: \"auto\",\r\n        }}\r\n      >\r\n        <RouteInfo routeName={routeName} />\r\n      </div>\r\n    </main>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}