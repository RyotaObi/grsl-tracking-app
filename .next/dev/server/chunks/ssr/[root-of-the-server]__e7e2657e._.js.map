{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/components/map-wrapper.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport dynamic from \"next/dynamic\"\r\nimport type { LocationData } from \"@/lib/types\"\r\nimport type { Map as LeafletMap } from \"leaflet\"\r\n\r\ninterface MapProps {\r\n  locations: LocationData[]\r\n  plannedRoute?: [number, number][]\r\n  onMapReady?: (map: LeafletMap) => void\r\n  userLocation?: { lat: number; lng: number } | null\r\n}\r\n\r\nconst Map = dynamic(() => import(\"@/components/map\"), {\r\n  ssr: false,\r\n  loading: () => (\r\n    <div className=\"w-full h-full flex items-center justify-center bg-gray-100\">\r\n      <div className=\"text-gray-600\">地図を読み込んでいます...</div>\r\n    </div>\r\n  ),\r\n})\r\n\r\nexport function MapWrapper(props: MapProps) {\r\n  return <Map {...props} />\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;AAFA;;;AAaA,MAAM,MAAM,IAAA,0KAAO;;;;;;IACjB,KAAK;IACL,SAAS,kBACP,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BAAgB;;;;;;;;;;;;AAK9B,SAAS,WAAW,KAAe;IACxC,qBAAO,8OAAC;QAAK,GAAG,KAAK;;;;;;AACvB","debugId":null}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/components/zoom-controls.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport type { Map as LeafletMap } from \"leaflet\"\r\n\r\ninterface ZoomControlsProps {\r\n  map: LeafletMap | null\r\n  onUserLocation: () => void\r\n  onVehicleLocation: () => void\r\n}\r\n\r\nexport function ZoomControls({ map, onUserLocation, onVehicleLocation }: ZoomControlsProps) {\r\n  const handleZoomIn = () => {\r\n    if (map) {\r\n      map.zoomIn()\r\n    }\r\n  }\r\n\r\n  const handleZoomOut = () => {\r\n    if (map) {\r\n      map.zoomOut()\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div style={{ display: \"flex\", flexDirection: \"column\", gap: \"12px\" }}>\r\n      {/* 拡大ボタン */}\r\n      <button\r\n        onClick={handleZoomIn}\r\n        style={{\r\n          width: \"48px\",\r\n          height: \"48px\",\r\n          borderRadius: \"50%\",\r\n          background: \"rgba(255, 255, 255, 0.95)\",\r\n          boxShadow: \"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)\",\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          justifyContent: \"center\",\r\n          border: \"none\",\r\n          cursor: \"pointer\",\r\n        }}\r\n        aria-label=\"拡大\"\r\n      >\r\n        <svg\r\n          width=\"24\"\r\n          height=\"24\"\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          stroke=\"#364153\"\r\n          strokeWidth=\"2\"\r\n          strokeLinecap=\"round\"\r\n          strokeLinejoin=\"round\"\r\n        >\r\n          <circle cx=\"11\" cy=\"11\" r=\"8\" />\r\n          <path d=\"M21 21l-4.35-4.35\" />\r\n          <line x1=\"11\" y1=\"8\" x2=\"11\" y2=\"14\" />\r\n          <line x1=\"8\" y1=\"11\" x2=\"14\" y2=\"11\" />\r\n        </svg>\r\n      </button>\r\n\r\n      {/* 縮小ボタン */}\r\n      <button\r\n        onClick={handleZoomOut}\r\n        style={{\r\n          width: \"48px\",\r\n          height: \"48px\",\r\n          borderRadius: \"50%\",\r\n          background: \"rgba(255, 255, 255, 0.95)\",\r\n          boxShadow: \"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)\",\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          justifyContent: \"center\",\r\n          border: \"none\",\r\n          cursor: \"pointer\",\r\n        }}\r\n        aria-label=\"縮小\"\r\n      >\r\n        <svg\r\n          width=\"24\"\r\n          height=\"24\"\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          stroke=\"#364153\"\r\n          strokeWidth=\"2\"\r\n          strokeLinecap=\"round\"\r\n          strokeLinejoin=\"round\"\r\n        >\r\n          <circle cx=\"11\" cy=\"11\" r=\"8\" />\r\n          <path d=\"M21 21l-4.35-4.35\" />\r\n          <line x1=\"8\" y1=\"11\" x2=\"14\" y2=\"11\" />\r\n        </svg>\r\n      </button>\r\n\r\n      {/* ユーザー位置ボタン（青） */}\r\n      <button\r\n        onClick={onUserLocation}\r\n        style={{\r\n          width: \"48px\",\r\n          height: \"48px\",\r\n          borderRadius: \"50%\",\r\n          background: \"linear-gradient(135deg, #2B7FFF 0%, #51A2FF 100%)\",\r\n          boxShadow: \"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)\",\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          justifyContent: \"center\",\r\n          border: \"none\",\r\n          cursor: \"pointer\",\r\n        }}\r\n        aria-label=\"現在位置\"\r\n      >\r\n        <svg\r\n          width=\"24\"\r\n          height=\"24\"\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          stroke=\"white\"\r\n          strokeWidth=\"2\"\r\n          strokeLinecap=\"round\"\r\n          strokeLinejoin=\"round\"\r\n        >\r\n          <polygon points=\"3 11 22 2 13 21 11 13 3 11\" />\r\n        </svg>\r\n      </button>\r\n\r\n      {/* 車両位置ボタン（緑） */}\r\n      <button\r\n        onClick={onVehicleLocation}\r\n        style={{\r\n          width: \"48px\",\r\n          height: \"48px\",\r\n          borderRadius: \"50%\",\r\n          background: \"linear-gradient(135deg, #00C950 0%, #00D492 100%)\",\r\n          boxShadow: \"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)\",\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n          justifyContent: \"center\",\r\n          border: \"none\",\r\n          cursor: \"pointer\",\r\n        }}\r\n        aria-label=\"車両位置\"\r\n      >\r\n        <svg\r\n          width=\"24\"\r\n          height=\"24\"\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          stroke=\"white\"\r\n          strokeWidth=\"2\"\r\n          strokeLinecap=\"round\"\r\n          strokeLinejoin=\"round\"\r\n        >\r\n          <path d=\"M5 17h-2v-6l2-5h9l4 5v6h-2\" />\r\n          <circle cx=\"7\" cy=\"17\" r=\"2\" />\r\n          <path d=\"M9 17h6\" />\r\n          <circle cx=\"17\" cy=\"17\" r=\"2\" />\r\n          <path d=\"M16 5l3 5\" />\r\n          <path d=\"M5 11h11\" />\r\n        </svg>\r\n      </button>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;AAUO,SAAS,aAAa,EAAE,GAAG,EAAE,cAAc,EAAE,iBAAiB,EAAqB;IACxF,MAAM,eAAe;QACnB,IAAI,KAAK;YACP,IAAI,MAAM;QACZ;IACF;IAEA,MAAM,gBAAgB;QACpB,IAAI,KAAK;YACP,IAAI,OAAO;QACb;IACF;IAEA,qBACE,8OAAC;QAAI,OAAO;YAAE,SAAS;YAAQ,eAAe;YAAU,KAAK;QAAO;;0BAElE,8OAAC;gBACC,SAAS;gBACT,OAAO;oBACL,OAAO;oBACP,QAAQ;oBACR,cAAc;oBACd,YAAY;oBACZ,WAAW;oBACX,SAAS;oBACT,YAAY;oBACZ,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA,cAAW;0BAEX,cAAA,8OAAC;oBACC,OAAM;oBACN,QAAO;oBACP,SAAQ;oBACR,MAAK;oBACL,QAAO;oBACP,aAAY;oBACZ,eAAc;oBACd,gBAAe;;sCAEf,8OAAC;4BAAO,IAAG;4BAAK,IAAG;4BAAK,GAAE;;;;;;sCAC1B,8OAAC;4BAAK,GAAE;;;;;;sCACR,8OAAC;4BAAK,IAAG;4BAAK,IAAG;4BAAI,IAAG;4BAAK,IAAG;;;;;;sCAChC,8OAAC;4BAAK,IAAG;4BAAI,IAAG;4BAAK,IAAG;4BAAK,IAAG;;;;;;;;;;;;;;;;;0BAKpC,8OAAC;gBACC,SAAS;gBACT,OAAO;oBACL,OAAO;oBACP,QAAQ;oBACR,cAAc;oBACd,YAAY;oBACZ,WAAW;oBACX,SAAS;oBACT,YAAY;oBACZ,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA,cAAW;0BAEX,cAAA,8OAAC;oBACC,OAAM;oBACN,QAAO;oBACP,SAAQ;oBACR,MAAK;oBACL,QAAO;oBACP,aAAY;oBACZ,eAAc;oBACd,gBAAe;;sCAEf,8OAAC;4BAAO,IAAG;4BAAK,IAAG;4BAAK,GAAE;;;;;;sCAC1B,8OAAC;4BAAK,GAAE;;;;;;sCACR,8OAAC;4BAAK,IAAG;4BAAI,IAAG;4BAAK,IAAG;4BAAK,IAAG;;;;;;;;;;;;;;;;;0BAKpC,8OAAC;gBACC,SAAS;gBACT,OAAO;oBACL,OAAO;oBACP,QAAQ;oBACR,cAAc;oBACd,YAAY;oBACZ,WAAW;oBACX,SAAS;oBACT,YAAY;oBACZ,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA,cAAW;0BAEX,cAAA,8OAAC;oBACC,OAAM;oBACN,QAAO;oBACP,SAAQ;oBACR,MAAK;oBACL,QAAO;oBACP,aAAY;oBACZ,eAAc;oBACd,gBAAe;8BAEf,cAAA,8OAAC;wBAAQ,QAAO;;;;;;;;;;;;;;;;0BAKpB,8OAAC;gBACC,SAAS;gBACT,OAAO;oBACL,OAAO;oBACP,QAAQ;oBACR,cAAc;oBACd,YAAY;oBACZ,WAAW;oBACX,SAAS;oBACT,YAAY;oBACZ,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA,cAAW;0BAEX,cAAA,8OAAC;oBACC,OAAM;oBACN,QAAO;oBACP,SAAQ;oBACR,MAAK;oBACL,QAAO;oBACP,aAAY;oBACZ,eAAc;oBACd,gBAAe;;sCAEf,8OAAC;4BAAK,GAAE;;;;;;sCACR,8OAAC;4BAAO,IAAG;4BAAI,IAAG;4BAAK,GAAE;;;;;;sCACzB,8OAAC;4BAAK,GAAE;;;;;;sCACR,8OAAC;4BAAO,IAAG;4BAAK,IAAG;4BAAK,GAAE;;;;;;sCAC1B,8OAAC;4BAAK,GAAE;;;;;;sCACR,8OAAC;4BAAK,GAAE;;;;;;;;;;;;;;;;;;;;;;;AAKlB","debugId":null}},
    {"offset": {"line": 355, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/components/passenger-count.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useMemo, useState } from \"react\"\r\n\r\nconst DEFAULT_API_URL =\r\n  \"https://script.google.com/macros/s/AKfycbwThG3VL9uOp66B0GWPZ7Atfx94kum0otelGilFWFx6_WnYct_48I2EjqkiS961XFbT/exec\"\r\nconst MAX_SEATS = 5\r\n\r\nfunction ChairIcon({ size }: { size: number }) {\r\n  return (\r\n    <svg viewBox=\"0 0 70 70\" xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" width={size} height={size}>\r\n      <path d=\"M25 45 L40 45\" stroke=\"#68707F\" strokeWidth=\"6\" strokeLinecap=\"round\" fill=\"none\" />\r\n      <path d=\"M40 45 L47 15\" stroke=\"#68707F\" strokeWidth=\"6\" strokeLinecap=\"round\" fill=\"none\" />\r\n    </svg>\r\n  )\r\n}\r\n\r\nfunction PersonIcon({ size }: { size: number }) {\r\n  return (\r\n    <svg viewBox=\"0 0 70 70\" xmlns=\"http://www.w3.org/2000/svg\" aria-hidden=\"true\" width={size} height={size}>\r\n      <circle cx=\"45\" cy=\"8\" r=\"8\" fill=\"#68707F\" />\r\n      <path d=\"M42 23 L37 43\" stroke=\"#68707F\" strokeWidth=\"12\" strokeLinecap=\"round\" fill=\"none\" />\r\n      <path d=\"M37 45 L22 45\" stroke=\"#68707F\" strokeWidth=\"8\" strokeLinecap=\"round\" fill=\"none\" />\r\n      <path d=\"M22 45 L22 65\" stroke=\"#68707F\" strokeWidth=\"8\" strokeLinecap=\"round\" fill=\"none\" />\r\n    </svg>\r\n  )\r\n}\r\n\r\nexport function PassengerCount() {\r\n  const [count, setCount] = useState<number | null>(null)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [overrideCount, setOverrideCount] = useState<number | null>(() => {\r\n    const envValue = process.env.NEXT_PUBLIC_PASSENGER_COUNT_OVERRIDE\r\n    if (!envValue) return null\r\n    const parsed = Number(envValue)\r\n    return Number.isFinite(parsed) ? Math.max(0, parsed) : null\r\n  })\r\n  const [isMobile, setIsMobile] = useState(false)\r\n  const apiUrl = useMemo(() => process.env.NEXT_PUBLIC_PASSENGER_COUNT_API ?? DEFAULT_API_URL, [])\r\n\r\n  useEffect(() => {\r\n    if (typeof window === \"undefined\") return\r\n    const params = new URLSearchParams(window.location.search)\r\n    const debugParam = params.get(\"debugCount\")\r\n    if (debugParam !== null) {\r\n      const parsed = Number(debugParam)\r\n      if (Number.isFinite(parsed)) {\r\n        setOverrideCount(Math.max(0, parsed))\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (typeof window === \"undefined\") return\r\n    const matcher = window.matchMedia(\"(max-width: 640px)\")\r\n    const handler = (event: MediaQueryListEvent | MediaQueryList) => {\r\n      setIsMobile(event.matches)\r\n    }\r\n    handler(matcher)\r\n    matcher.addEventListener(\"change\", handler)\r\n    return () => matcher.removeEventListener(\"change\", handler as (event: MediaQueryListEvent) => void)\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (overrideCount !== null) {\r\n      setCount(overrideCount)\r\n      setError(null)\r\n      return\r\n    }\r\n\r\n    let isMounted = true\r\n\r\n    async function fetchCount() {\r\n      try {\r\n        const controller = new AbortController()\r\n        const timeoutId = setTimeout(() => controller.abort(), 10000) // 10秒でタイムアウト\r\n        \r\n        const res = await fetch(`${apiUrl}?mode=last&t=${Date.now()}`, {\r\n          signal: controller.signal,\r\n          mode: \"cors\",\r\n          cache: \"no-cache\",\r\n        })\r\n        \r\n        clearTimeout(timeoutId)\r\n        \r\n        if (!res.ok) {\r\n          throw new Error(`API responded with ${res.status}`)\r\n        }\r\n        const data = await res.json()\r\n        const raw = Number(data?.count) - 2\r\n        const sanitized = Number.isFinite(raw) ? Math.max(0, raw) : 0\r\n        if (isMounted) {\r\n          setCount(sanitized)\r\n          setError(null)\r\n        }\r\n      } catch (err) {\r\n        // エラーをログに記録するが、ユーザーには表示しない\r\n        // 次回の取得（5秒後）で成功する可能性があるため\r\n        if (err instanceof Error) {\r\n          if (err.name === \"AbortError\") {\r\n            console.warn(\"[v0] Passenger count fetch timeout\")\r\n          } else if (err.message.includes(\"Failed to fetch\") || err.message.includes(\"NetworkError\")) {\r\n            console.warn(\"[v0] Passenger count fetch failed (network error) - will retry\")\r\n          } else {\r\n            console.error(\"[v0] Failed to fetch passenger count:\", err.message)\r\n          }\r\n        } else {\r\n          console.error(\"[v0] Failed to fetch passenger count:\", err)\r\n        }\r\n        // エラーが発生しても既存のカウントを保持\r\n        // 初回取得失敗時は count が null のままなので、\"取得中...\" が表示される\r\n      }\r\n    }\r\n\r\n    fetchCount()\r\n    const timer = setInterval(fetchCount, 60000) // 1分ごとにアクセス（スプレッドシートの更新頻度に合わせる）\r\n\r\n    return () => {\r\n      isMounted = false\r\n      clearInterval(timer)\r\n    }\r\n  }, [apiUrl, overrideCount])\r\n\r\n  const iconSize = isMobile ? 28 : 48\r\n\r\n  const seatSlots = useMemo(() => {\r\n    const active = Math.min(Math.max(count ?? 0, 0), MAX_SEATS)\r\n    return Array.from({ length: MAX_SEATS }).map((_, index) => {\r\n      const filled = index < active\r\n      return (\r\n        <div\r\n          key={index}\r\n          style={{\r\n            position: \"relative\",\r\n            width: iconSize,\r\n            height: iconSize,\r\n          }}\r\n        >\r\n          <div style={{ opacity: 0.9 }}>\r\n            <ChairIcon size={iconSize} />\r\n          </div>\r\n          {filled && (\r\n            <div style={{ position: \"absolute\", top: -5, left: -4 }}>\r\n              <PersonIcon size={iconSize} />\r\n            </div>\r\n          )}\r\n        </div>\r\n      )\r\n    })\r\n  }, [count, iconSize])\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        background: \"rgba(255, 255, 255, 0.95)\",\r\n        borderRadius: \"16px\",\r\n        boxShadow: \"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)\",\r\n        padding: isMobile ? \"8px 12px\" : \"12px 16px\",\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n        gap: isMobile ? \"8px\" : \"12px\",\r\n        minWidth: isMobile ? \"140px\" : \"220px\",\r\n      }}\r\n    >\r\n      <div style={{ display: \"flex\", alignItems: \"center\", gap: isMobile ? \"8px\" : \"12px\" }}>\r\n        <svg\r\n          width={isMobile ? 18 : 24}\r\n          height={isMobile ? 18 : 24}\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          stroke=\"#364153\"\r\n          strokeWidth=\"2\"\r\n          strokeLinecap=\"round\"\r\n          strokeLinejoin=\"round\"\r\n        >\r\n          <path d=\"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\" />\r\n          <circle cx=\"9\" cy=\"7\" r=\"4\" />\r\n          <path d=\"M23 21v-2a4 4 0 0 0-3-3.87\" />\r\n          <path d=\"M16 3.13a4 4 0 0 1 0 7.75\" />\r\n        </svg>\r\n        <div>\r\n          <div style={{ fontSize: isMobile ? \"10px\" : \"12px\", color: \"#4B5563\" }}>現在の混雑状況</div>\r\n          <div style={{ fontSize: isMobile ? \"14px\" : \"18px\", fontWeight: \"bold\", color: \"#111827\" }}>\r\n            {error ? error : count === null ? \"取得中...\" : `${count}人`}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div style={{ display: \"flex\", gap: isMobile ? \"2px\" : \"4px\" }}>{seatSlots}</div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 726, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/components/route-info.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport type { DaySchedule } from \"@/lib/types\"\r\n\r\ninterface RouteInfoProps {\r\n  schedule: DaySchedule | null\r\n  isOperating: boolean\r\n}\r\n\r\nexport function RouteInfo({ schedule, isOperating }: RouteInfoProps) {\r\n  if (!schedule || !isOperating) {\r\n    return null\r\n  }\r\n\r\n  const displayText =\r\n    schedule.routeType === \"循環ルート\"\r\n      ? `循環ルート走行中 ${schedule.startTime}～${schedule.endTime}`\r\n      : `フリー運行中 ${schedule.startTime}～${schedule.endTime}`\r\n\r\n  return (\r\n    <div style={{ width: \"100%\" }}>\r\n      <div\r\n        style={{\r\n          background: \"rgba(255, 255, 255, 0.95)\",\r\n          borderRadius: \"24px 24px 0 0\",\r\n          boxShadow: \"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)\",\r\n          padding: \"16px 24px\",\r\n        }}\r\n      >\r\n        <div style={{ textAlign: \"center\" }}>\r\n          <div style={{ fontSize: \"20px\", fontWeight: \"bold\", color: \"#111827\" }}>{displayText}</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;AASO,SAAS,UAAU,EAAE,QAAQ,EAAE,WAAW,EAAkB;IACjE,IAAI,CAAC,YAAY,CAAC,aAAa;QAC7B,OAAO;IACT;IAEA,MAAM,cACJ,SAAS,SAAS,KAAK,UACnB,CAAC,SAAS,EAAE,SAAS,SAAS,CAAC,CAAC,EAAE,SAAS,OAAO,EAAE,GACpD,CAAC,OAAO,EAAE,SAAS,SAAS,CAAC,CAAC,EAAE,SAAS,OAAO,EAAE;IAExD,qBACE,8OAAC;QAAI,OAAO;YAAE,OAAO;QAAO;kBAC1B,cAAA,8OAAC;YACC,OAAO;gBACL,YAAY;gBACZ,cAAc;gBACd,WAAW;gBACX,SAAS;YACX;sBAEA,cAAA,8OAAC;gBAAI,OAAO;oBAAE,WAAW;gBAAS;0BAChC,cAAA,8OAAC;oBAAI,OAAO;wBAAE,UAAU;wBAAQ,YAAY;wBAAQ,OAAO;oBAAU;8BAAI;;;;;;;;;;;;;;;;;;;;;AAKnF","debugId":null}},
    {"offset": {"line": 875, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/lib/utils/simplify-route.ts"],"sourcesContent":["// Douglas-Peucker アルゴリズムを使用してルートを簡略化\r\nexport function simplifyRoute(\r\n  points: { lat: number; lng: number }[],\r\n  tolerance = 0.0001,\r\n): { lat: number; lng: number }[] {\r\n  if (points.length <= 2) {\r\n    return points\r\n  }\r\n\r\n  // 最初と最後のポイントを結ぶ線からの最大距離を持つポイントを見つける\r\n  let maxDistance = 0\r\n  let maxIndex = 0\r\n  const start = points[0]\r\n  const end = points[points.length - 1]\r\n\r\n  for (let i = 1; i < points.length - 1; i++) {\r\n    const distance = perpendicularDistance(points[i], start, end)\r\n    if (distance > maxDistance) {\r\n      maxDistance = distance\r\n      maxIndex = i\r\n    }\r\n  }\r\n\r\n  // 最大距離がtoleranceより大きい場合、再帰的に分割\r\n  if (maxDistance > tolerance) {\r\n    const left = simplifyRoute(points.slice(0, maxIndex + 1), tolerance)\r\n    const right = simplifyRoute(points.slice(maxIndex), tolerance)\r\n\r\n    // 結合（中間のポイントを重複させないため、leftの最後を除く）\r\n    return [...left.slice(0, -1), ...right]\r\n  } else {\r\n    // toleranceより小さい場合、最初と最後のポイントだけを返す\r\n    return [start, end]\r\n  }\r\n}\r\n\r\n// ポイントから線分への垂直距離を計算\r\nfunction perpendicularDistance(\r\n  point: { lat: number; lng: number },\r\n  lineStart: { lat: number; lng: number },\r\n  lineEnd: { lat: number; lng: number },\r\n): number {\r\n  const x = point.lng\r\n  const y = point.lat\r\n  const x1 = lineStart.lng\r\n  const y1 = lineStart.lat\r\n  const x2 = lineEnd.lng\r\n  const y2 = lineEnd.lat\r\n\r\n  const A = x - x1\r\n  const B = y - y1\r\n  const C = x2 - x1\r\n  const D = y2 - y1\r\n\r\n  const dot = A * C + B * D\r\n  const lenSq = C * C + D * D\r\n\r\n  let param = -1\r\n  if (lenSq !== 0) {\r\n    param = dot / lenSq\r\n  }\r\n\r\n  let xx, yy\r\n\r\n  if (param < 0) {\r\n    xx = x1\r\n    yy = y1\r\n  } else if (param > 1) {\r\n    xx = x2\r\n    yy = y2\r\n  } else {\r\n    xx = x1 + param * C\r\n    yy = y1 + param * D\r\n  }\r\n\r\n  const dx = x - xx\r\n  const dy = y - yy\r\n\r\n  return Math.sqrt(dx * dx + dy * dy)\r\n}\r\n\r\n// 重複ポイントを削除（GPSの精度による微小な揺れを除去）\r\nexport function removeDuplicatePoints(\r\n  points: { lat: number; lng: number }[],\r\n  minDistance = 0.00001, // 約1メートル\r\n): { lat: number; lng: number }[] {\r\n  if (points.length <= 1) {\r\n    return points\r\n  }\r\n\r\n  const result: { lat: number; lng: number }[] = [points[0]]\r\n\r\n  for (let i = 1; i < points.length; i++) {\r\n    const prev = result[result.length - 1]\r\n    const curr = points[i]\r\n\r\n    const distance = Math.sqrt(Math.pow(curr.lat - prev.lat, 2) + Math.pow(curr.lng - prev.lng, 2))\r\n\r\n    if (distance >= minDistance) {\r\n      result.push(curr)\r\n    }\r\n  }\r\n\r\n  return result\r\n}\r\n\r\nexport async function snapToRoads(\r\n  points: { lat: number; lng: number }[],\r\n): Promise<{ lat: number; lng: number }[] | null> {\r\n  try {\r\n    // OSRM has a limit of 100 points per request\r\n    // First simplify to reduce points if necessary\r\n    let processedPoints = points\r\n    if (points.length > 100) {\r\n      processedPoints = simplifyRoute(points, 0.0002) // More aggressive simplification\r\n      console.log(`[v0] Reduced points for OSRM: ${points.length} → ${processedPoints.length}`)\r\n    }\r\n\r\n    // Format coordinates for OSRM: \"lng,lat;lng,lat;...\"\r\n    const coordinates = processedPoints.map((p) => `${p.lng},${p.lat}`).join(\";\")\r\n\r\n    // Call OSRM Map Matching API\r\n    const url = `https://router.project-osrm.org/match/v1/driving/${coordinates}?overview=full&geometries=geojson`\r\n\r\n    console.log(`[v0] Calling OSRM Map Matching API with ${processedPoints.length} points...`)\r\n\r\n    const response = await fetch(url)\r\n    if (!response.ok) {\r\n      throw new Error(`OSRM API error: ${response.status}`)\r\n    }\r\n\r\n    const data = await response.json()\r\n\r\n    if (data.code !== \"Ok\" || !data.matchings || data.matchings.length === 0) {\r\n      console.error(\"[v0] OSRM matching failed:\", data.message)\r\n      return null\r\n    }\r\n\r\n    // Extract matched coordinates\r\n    const matchedCoordinates = data.matchings[0].geometry.coordinates.map((coord: [number, number]) => ({\r\n      lng: coord[0],\r\n      lat: coord[1],\r\n    }))\r\n\r\n    console.log(`[v0] OSRM Map Matching successful: ${processedPoints.length} → ${matchedCoordinates.length} points`)\r\n\r\n    return matchedCoordinates\r\n  } catch (error) {\r\n    console.error(\"[v0] Error in road snapping:\", error)\r\n    return null\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1006, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/lib/firebase.ts"],"sourcesContent":["import { initializeApp, getApps } from \"firebase/app\"\r\nimport {\r\n  getFirestore,\r\n  collection,\r\n  query,\r\n  orderBy,\r\n  onSnapshot,\r\n  Timestamp,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  setDoc,\r\n} from \"firebase/firestore\"\r\nimport type { LocationData, SavedRoute, ActiveRouteSettings, DaySchedule, MonthSchedule } from \"./types\"\r\nimport { simplifyRoute, removeDuplicatePoints, snapToRoads } from \"./utils/simplify-route\"\r\n\r\nconst firebaseConfig = {\r\n  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\r\n  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\r\n  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\r\n  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\r\n  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\r\n  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\r\n  measurementId: process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID,\r\n}\r\n\r\n// Initialize Firebase (singleton pattern)\r\nconst app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0]\r\nconst db = getFirestore(app)\r\n\r\nexport { app, db }\r\n\r\nexport function getRealtimeLocations(\r\n  collectionName: string,\r\n  callback: (locations: LocationData[]) => void,\r\n): () => void {\r\n  const locationsRef = collection(db, collectionName)\r\n  const q = query(locationsRef, orderBy(\"timestamp\", \"asc\"))\r\n\r\n  const unsubscribe = onSnapshot(\r\n    q,\r\n    (snapshot) => {\r\n      const locations: LocationData[] = []\r\n      snapshot.forEach((doc) => {\r\n        const data = doc.data()\r\n        locations.push({\r\n          id: doc.id,\r\n          latitude: data.latitude,\r\n          longitude: data.longitude,\r\n          timestamp: data.timestamp instanceof Timestamp ? data.timestamp.toDate() : new Date(data.timestamp),\r\n          speed: data.speed,\r\n          accuracy: data.accuracy,\r\n        })\r\n      })\r\n      callback(locations)\r\n    },\r\n    (error) => {\r\n      console.error(\"[v0] Firestore error:\", error)\r\n    },\r\n  )\r\n\r\n  return unsubscribe\r\n}\r\n\r\nexport async function getActiveRoute(): Promise<string | null> {\r\n  try {\r\n    const docRef = doc(db, \"settings\", \"active-route\")\r\n    const docSnap = await getDoc(docRef)\r\n\r\n    if (docSnap.exists()) {\r\n      const data = docSnap.data() as ActiveRouteSettings\r\n      return data.routeId\r\n    }\r\n    return null\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting active route:\", error)\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function getSavedRoute(routeId: string): Promise<SavedRoute | null> {\r\n  try {\r\n    const docRef = doc(db, \"saved-routes\", routeId)\r\n    const docSnap = await getDoc(docRef)\r\n\r\n    if (docSnap.exists()) {\r\n      return docSnap.data() as SavedRoute\r\n    }\r\n    return null\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting saved route:\", error)\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function getSavedRoutes(): Promise<{ id: string; name: string; pointCount: number }[]> {\r\n  try {\r\n    const routesRef = collection(db, \"saved-routes\")\r\n    const snapshot = await getDocs(routesRef)\r\n    return snapshot.docs.map((docSnap) => {\r\n      const data = docSnap.data() as SavedRoute\r\n      return {\r\n        id: docSnap.id,\r\n        name: data.name || docSnap.id,\r\n        pointCount: data.points?.length || 0,\r\n      }\r\n    })\r\n  } catch (error) {\r\n    console.error(\"[v0] Error listing saved routes:\", error)\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function getDateCollections(): Promise<string[]> {\r\n  try {\r\n    const docRef = doc(db, \"date-index\", \"dates\")\r\n    const docSnap = await getDoc(docRef)\r\n\r\n    if (docSnap.exists()) {\r\n      const data = docSnap.data()\r\n      const dateList = data.dateList as string[]\r\n\r\n      // Sort by date descending (newest first)\r\n      return dateList.sort((a, b) => {\r\n        const dateA = a.split(\"_\")[0]\r\n        const dateB = b.split(\"_\")[0]\r\n        return dateB.localeCompare(dateA)\r\n      })\r\n    }\r\n\r\n    return []\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting date index:\", error)\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function getAllLocationsFromCollection(collectionName: string): Promise<LocationData[]> {\r\n  try {\r\n    const locationsRef = collection(db, collectionName)\r\n    const q = query(locationsRef, orderBy(\"timestamp\", \"asc\"))\r\n    const snapshot = await getDocs(q)\r\n\r\n    const locations: LocationData[] = []\r\n    snapshot.forEach((doc) => {\r\n      const data = doc.data()\r\n      locations.push({\r\n        id: doc.id,\r\n        latitude: data.latitude,\r\n        longitude: data.longitude,\r\n        timestamp: data.timestamp instanceof Timestamp ? data.timestamp.toDate() : new Date(data.timestamp),\r\n        speed: data.speed,\r\n        accuracy: data.accuracy,\r\n      })\r\n    })\r\n\r\n    return locations\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting locations from collection:\", error)\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function saveRouteAsActive(routeId: string, locations: LocationData[]): Promise<boolean> {\r\n  try {\r\n    const points = locations.map((loc) => ({\r\n      lat: loc.latitude,\r\n      lng: loc.longitude,\r\n      timestamp: loc.timestamp instanceof Date ? loc.timestamp.toISOString() : loc.timestamp,\r\n    }))\r\n\r\n    const deduplicated = removeDuplicatePoints(points)\r\n    console.log(`[v0] Step 1 - Deduplication: ${points.length} → ${deduplicated.length} points`)\r\n\r\n    const snapped = await snapToRoads(deduplicated)\r\n\r\n    let finalPoints: { lat: number; lng: number }[]\r\n\r\n    if (snapped) {\r\n      console.log(`[v0] Step 2 - Road snapping successful: ${snapped.length} points`)\r\n      finalPoints = snapped\r\n    } else {\r\n      console.log(\"[v0] Step 2 - Road snapping failed, using Douglas-Peucker instead\")\r\n      const simplified = simplifyRoute(deduplicated, 0.0001)\r\n      console.log(`[v0] Step 2 - Simplification: ${deduplicated.length} → ${simplified.length} points`)\r\n      finalPoints = simplified\r\n    }\r\n\r\n    // Save route data to /saved-routes/{routeId}\r\n    const routeDocRef = doc(db, \"saved-routes\", routeId)\r\n    const savedRoute: SavedRoute = {\r\n      name: `${routeId}のルート`,\r\n      createdAt: new Date().toISOString(),\r\n      points: finalPoints,\r\n    }\r\n    await setDoc(routeDocRef, savedRoute)\r\n\r\n    // Update /settings/active-route to point to this route\r\n    const settingsDocRef = doc(db, \"settings\", \"active-route\")\r\n    const activeSettings: ActiveRouteSettings = {\r\n      routeId: routeId,\r\n      updatedAt: new Date().toISOString(),\r\n    }\r\n    await setDoc(settingsDocRef, activeSettings)\r\n\r\n    return true\r\n  } catch (error) {\r\n    console.error(\"[v0] Error saving route:\", error)\r\n    return false\r\n  }\r\n}\r\n\r\nexport async function saveCustomRoute(\r\n  routeId: string,\r\n  points: [number, number][],\r\n  options?: { name?: string },\r\n): Promise<boolean> {\r\n  try {\r\n    const routeDocRef = doc(db, \"saved-routes\", routeId)\r\n    const savedRoute: SavedRoute = {\r\n      name: options?.name || `${routeId}のルート`,\r\n      createdAt: new Date().toISOString(),\r\n      points: points.map(([lat, lng]) => ({ lat, lng })),\r\n    }\r\n    await setDoc(routeDocRef, savedRoute)\r\n    return true\r\n  } catch (error) {\r\n    console.error(\"[v0] Error saving custom route:\", error)\r\n    return false\r\n  }\r\n}\r\n\r\nexport async function saveMonthSchedule(yearMonth: string, schedule: MonthSchedule): Promise<boolean> {\r\n  try {\r\n    const docRef = doc(db, \"schedules\", yearMonth)\r\n    await setDoc(docRef, {\r\n      yearMonth,\r\n      days: schedule,\r\n      updatedAt: new Date().toISOString(),\r\n    })\r\n    return true\r\n  } catch (error) {\r\n    console.error(\"[v0] Error saving schedule:\", error)\r\n    return false\r\n  }\r\n}\r\n\r\nexport async function getMonthSchedule(yearMonth: string): Promise<MonthSchedule | null> {\r\n  try {\r\n    const docRef = doc(db, \"schedules\", yearMonth)\r\n    const docSnap = await getDoc(docRef)\r\n\r\n    if (docSnap.exists()) {\r\n      const data = docSnap.data()\r\n      const schedule = data.days as MonthSchedule\r\n      // 後方互換性: 単一のDayScheduleを配列に変換\r\n      const normalized: MonthSchedule = {}\r\n      for (const [dateStr, daySchedule] of Object.entries(schedule)) {\r\n        if (Array.isArray(daySchedule)) {\r\n          normalized[dateStr] = daySchedule\r\n        } else {\r\n          normalized[dateStr] = [daySchedule]\r\n        }\r\n      }\r\n      return normalized\r\n    }\r\n    return null\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting schedule:\", error)\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function getCurrentScheduleStatus(): Promise<{\r\n  isOperating: boolean\r\n  schedule: DaySchedule | null\r\n  nextOperation?: {\r\n    date: string\r\n    dayOfWeek: string\r\n    startTime: string\r\n    endTime: string\r\n    startLocation: string\r\n  }\r\n} | null> {\r\n  try {\r\n    const now = new Date()\r\n    const yearMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, \"0\")}`\r\n    const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, \"0\")}-${String(now.getDate()).padStart(2, \"0\")}`\r\n\r\n    const schedule = await getMonthSchedule(yearMonth)\r\n    if (!schedule || !schedule[dateStr]) {\r\n      const nextOp = await findNextOperation(now)\r\n      return { isOperating: false, schedule: null, nextOperation: nextOp }\r\n    }\r\n\r\n    const daySchedules = Array.isArray(schedule[dateStr]) ? schedule[dateStr] : [schedule[dateStr]]\r\n    const currentTime = `${String(now.getHours()).padStart(2, \"0\")}:${String(now.getMinutes()).padStart(2, \"0\")}`\r\n\r\n    // 現在の時間に該当するスケジュールを探す\r\n    const activeSchedule = daySchedules.find(\r\n      (s) => s.isOperating && currentTime >= s.startTime && currentTime <= s.endTime,\r\n    )\r\n\r\n    if (activeSchedule) {\r\n      return { isOperating: true, schedule: activeSchedule }\r\n    }\r\n\r\n    // 運行中ではない場合、次回の運行を探す\r\n    const nextOp = await findNextOperation(now)\r\n    return { isOperating: false, schedule: daySchedules[0] || null, nextOperation: nextOp }\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting current schedule status:\", error)\r\n    return null\r\n  }\r\n}\r\n\r\nasync function findNextOperation(fromDate: Date): Promise<\r\n  | {\r\n      date: string\r\n      dayOfWeek: string\r\n      startTime: string\r\n      endTime: string\r\n      startLocation: string\r\n    }\r\n  | undefined\r\n> {\r\n  try {\r\n    const dayNames = [\"日\", \"月\", \"火\", \"水\", \"木\", \"金\", \"土\"]\r\n\r\n    // 今日から30日後まで検索\r\n    for (let i = 0; i < 30; i++) {\r\n      const checkDate = new Date(fromDate)\r\n      checkDate.setDate(checkDate.getDate() + i)\r\n\r\n      const yearMonth = `${checkDate.getFullYear()}-${String(checkDate.getMonth() + 1).padStart(2, \"0\")}`\r\n      const dateStr = `${checkDate.getFullYear()}-${String(checkDate.getMonth() + 1).padStart(2, \"0\")}-${String(checkDate.getDate()).padStart(2, \"0\")}`\r\n\r\n      const schedule = await getMonthSchedule(yearMonth)\r\n      if (!schedule || !schedule[dateStr]) continue\r\n\r\n      const daySchedules = Array.isArray(schedule[dateStr]) ? schedule[dateStr] : [schedule[dateStr]]\r\n      const operatingSchedules = daySchedules.filter((s) => s.isOperating)\r\n\r\n      if (operatingSchedules.length === 0) continue\r\n\r\n      const currentTime = `${String(fromDate.getHours()).padStart(2, \"0\")}:${String(fromDate.getMinutes()).padStart(2, \"0\")}`\r\n\r\n      // 同日の場合は、運行開始時刻が現在時刻より後のスケジュールを探す\r\n      if (i === 0) {\r\n        const futureSchedules = operatingSchedules.filter((s) => s.startTime > currentTime)\r\n        if (futureSchedules.length > 0) {\r\n          // 最も近い未来のスケジュールを選択\r\n          const nextSchedule = futureSchedules.sort((a, b) => a.startTime.localeCompare(b.startTime))[0]\r\n          return {\r\n            date: `${checkDate.getMonth() + 1}/${checkDate.getDate()}`,\r\n            dayOfWeek: dayNames[checkDate.getDay()],\r\n            startTime: nextSchedule.startTime,\r\n            endTime: nextSchedule.endTime,\r\n            startLocation: nextSchedule.startLocation || \"ヤンマー前\",\r\n          }\r\n        }\r\n        // 今日の運行時間は過ぎているので次の日を探す\r\n        continue\r\n      }\r\n\r\n      // 他の日の場合は、最初のスケジュールを返す\r\n      const firstSchedule = operatingSchedules.sort((a, b) => a.startTime.localeCompare(b.startTime))[0]\r\n      return {\r\n        date: `${checkDate.getMonth() + 1}/${checkDate.getDate()}`,\r\n        dayOfWeek: dayNames[checkDate.getDay()],\r\n        startTime: firstSchedule.startTime,\r\n        endTime: firstSchedule.endTime,\r\n        startLocation: firstSchedule.startLocation || \"ヤンマー前\",\r\n      }\r\n    }\r\n\r\n    return undefined\r\n  } catch (error) {\r\n    console.error(\"[v0] Error finding next operation:\", error)\r\n    return undefined\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1362, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/app/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useState, useCallback } from \"react\"\r\nimport { MapWrapper } from \"@/components/map-wrapper\"\r\nimport { ZoomControls } from \"@/components/zoom-controls\"\r\nimport { PassengerCount } from \"@/components/passenger-count\"\r\nimport { RouteInfo } from \"@/components/route-info\"\r\nimport { getRealtimeLocations, getSavedRoute, getCurrentScheduleStatus } from \"@/lib/firebase\"\r\nimport type { LocationData, DaySchedule } from \"@/lib/types\"\r\nimport type { Map as LeafletMap } from \"leaflet\"\r\n\r\nexport default function Home() {\r\n  const [locations, setLocations] = useState<LocationData[]>([])\r\n  const [map, setMap] = useState<LeafletMap | null>(null)\r\n  const [collectionName, setCollectionName] = useState<string>(\"\")\r\n  const [userLocation, setUserLocation] = useState<{ lat: number; lng: number } | null>(null)\r\n  const [plannedRoute, setPlannedRoute] = useState<[number, number][]>([])\r\n  const [currentSchedule, setCurrentSchedule] = useState<DaySchedule | null>(null)\r\n  const [isOperating, setIsOperating] = useState<boolean>(false)\r\n  const [nextOperation, setNextOperation] = useState<{\r\n    date: string\r\n    dayOfWeek: string\r\n    startTime: string\r\n    endTime: string\r\n    startLocation: string\r\n  } | null>(null)\r\n\r\n  // 今日の日付からコレクション名を生成\r\n  useEffect(() => {\r\n    const today = new Date()\r\n    const year = today.getFullYear()\r\n    const month = String(today.getMonth() + 1).padStart(2, \"0\")\r\n    const day = String(today.getDate()).padStart(2, \"0\")\r\n    const todayCollection = `${year}${month}${day}`\r\n    setCollectionName(todayCollection)\r\n  }, [])\r\n\r\n  // Firestoreからリアルタイムでデータを取得\r\n  useEffect(() => {\r\n    if (!collectionName) return\r\n\r\n    console.log(\"[v0] Subscribing to collection:\", collectionName)\r\n\r\n    const unsubscribe = getRealtimeLocations(collectionName, (newLocations) => {\r\n      console.log(\"[v0] Received locations:\", newLocations.length)\r\n      setLocations(newLocations)\r\n    })\r\n\r\n    return () => {\r\n      console.log(\"[v0] Unsubscribing from collection\")\r\n      unsubscribe()\r\n    }\r\n  }, [collectionName])\r\n\r\n  useEffect(() => {\r\n    if (\"geolocation\" in navigator) {\r\n      console.log(\"[v0] Starting continuous location tracking...\")\r\n\r\n      const watchId = navigator.geolocation.watchPosition(\r\n        (position) => {\r\n          const location = {\r\n            lat: position.coords.latitude,\r\n            lng: position.coords.longitude,\r\n          }\r\n          setUserLocation(location)\r\n          console.log(\"[v0] User location updated:\", location)\r\n        },\r\n        (error) => {\r\n          console.error(\"[v0] Geolocation error:\", error.code, error.message)\r\n          if (error.code === 1) {\r\n            console.error(\"[v0] Location permission denied by user\")\r\n          } else if (error.code === 2) {\r\n            console.error(\"[v0] Location unavailable\")\r\n          } else if (error.code === 3) {\r\n            console.error(\"[v0] Location request timeout\")\r\n          }\r\n        },\r\n        {\r\n          enableHighAccuracy: true,\r\n          timeout: 10000,\r\n          maximumAge: 0,\r\n        },\r\n      )\r\n\r\n      return () => {\r\n        console.log(\"[v0] Stopping location tracking\")\r\n        navigator.geolocation.clearWatch(watchId)\r\n      }\r\n    } else {\r\n      console.error(\"[v0] Geolocation not supported by browser\")\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    let startTimer: NodeJS.Timeout | null = null\r\n    let endTimer: NodeJS.Timeout | null = null\r\n    let scheduleCheckInterval: NodeJS.Timeout | null = null\r\n\r\n    // 運行開始・終了時刻を計算してタイマーを設定する関数\r\n    const setupTimers = async () => {\r\n      const status = await getCurrentScheduleStatus()\r\n      if (!status) return\r\n\r\n      // 既存のタイマーをクリア\r\n      if (startTimer) clearTimeout(startTimer)\r\n      if (endTimer) clearTimeout(endTimer)\r\n\r\n      setIsOperating(status.isOperating)\r\n      setCurrentSchedule(status.schedule)\r\n      setNextOperation(status.nextOperation || null)\r\n\r\n      const now = new Date()\r\n      const currentTime = now.getTime()\r\n\r\n      if (status.isOperating && status.schedule) {\r\n        // 現在運行中の場合：運行終了時刻にタイマーを設定\r\n        const [endHour, endMinute] = status.schedule.endTime.split(\":\").map(Number)\r\n        const endDate = new Date(now)\r\n        endDate.setHours(endHour, endMinute, 0, 0)\r\n\r\n        // 終了時刻が今日の場合はそのまま、過去の場合は明日に設定\r\n        if (endDate.getTime() <= currentTime) {\r\n          endDate.setDate(endDate.getDate() + 1)\r\n        }\r\n\r\n        const timeUntilEnd = endDate.getTime() - currentTime\r\n        if (timeUntilEnd > 0) {\r\n          endTimer = setTimeout(async () => {\r\n            setIsOperating(false)\r\n            // 終了後に次の運行を取得\r\n            await setupTimers()\r\n          }, timeUntilEnd)\r\n          console.log(`[v0] 運行終了タイマーを設定: ${endDate.toLocaleString()}`)\r\n        }\r\n      } else if (status.nextOperation) {\r\n        // 現在運行時間外の場合：次の運行開始時刻にタイマーを設定\r\n        // nextOperation.dateは \"12/2(火)\" のような形式なので、日付部分を抽出\r\n        const dateMatch = status.nextOperation.date.match(/^(\\d+)\\/(\\d+)/)\r\n        if (dateMatch) {\r\n          const [, monthStr, dayStr] = dateMatch\r\n          const month = parseInt(monthStr, 10)\r\n          const day = parseInt(dayStr, 10)\r\n          const [startHour, startMinute] = status.nextOperation.startTime.split(\":\").map(Number)\r\n\r\n          // 現在の年を基準に日付を作成\r\n          let startDate = new Date(now.getFullYear(), month - 1, day, startHour, startMinute, 0, 0)\r\n\r\n          // 開始時刻が過去の場合は、次の年を試す\r\n          if (startDate.getTime() <= currentTime) {\r\n            startDate = new Date(now.getFullYear() + 1, month - 1, day, startHour, startMinute, 0, 0)\r\n          }\r\n\r\n          // それでも過去の場合は、今月の該当日を探す（月をまたぐ場合）\r\n          if (startDate.getTime() <= currentTime) {\r\n            const currentMonth = now.getMonth()\r\n            const currentYear = now.getFullYear()\r\n            // 今月の該当日を試す\r\n            startDate = new Date(currentYear, currentMonth, day, startHour, startMinute, 0, 0)\r\n            // それでも過去の場合は来月\r\n            if (startDate.getTime() <= currentTime) {\r\n              startDate = new Date(currentYear, currentMonth + 1, day, startHour, startMinute, 0, 0)\r\n            }\r\n          }\r\n\r\n          const timeUntilStart = startDate.getTime() - currentTime\r\n          if (timeUntilStart > 0 && timeUntilStart < 30 * 24 * 60 * 60 * 1000) {\r\n            // 30日以内の場合のみタイマーを設定\r\n            startTimer = setTimeout(async () => {\r\n              // 開始時にスケジュールを再読み込み\r\n              await setupTimers()\r\n            }, timeUntilStart)\r\n            console.log(`[v0] 運行開始タイマーを設定: ${startDate.toLocaleString()}`)\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // 初回読み込み\r\n    setupTimers()\r\n\r\n    // スケジュール変更対応のため、1時間ごとに再チェック\r\n    // （スケジュール変更はめったにないため、1時間ごとで十分）\r\n    scheduleCheckInterval = setInterval(setupTimers, 60 * 60 * 1000) // 1時間\r\n\r\n    return () => {\r\n      if (startTimer) clearTimeout(startTimer)\r\n      if (endTimer) clearTimeout(endTimer)\r\n      if (scheduleCheckInterval) clearInterval(scheduleCheckInterval)\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    const loadActiveRoute = async () => {\r\n      if (!isOperating || !currentSchedule || currentSchedule.routeType !== \"循環ルート\") {\r\n        console.log(\"[v0] Not loading route - not operating or not circular route\")\r\n        setPlannedRoute([])\r\n        return\r\n      }\r\n\r\n      console.log(\"[v0] Loading active route...\")\r\n      const routeId = currentSchedule.routeId\r\n\r\n      if (routeId) {\r\n        console.log(\"[v0] Active route ID:\", routeId)\r\n        const savedRoute = await getSavedRoute(routeId)\r\n\r\n        if (savedRoute) {\r\n          console.log(\"[v0] Loaded saved route:\", savedRoute.name, \"with\", savedRoute.points.length, \"points\")\r\n          const routeCoords: [number, number][] = savedRoute.points.map((p) => [p.lat, p.lng])\r\n          setPlannedRoute(routeCoords)\r\n        } else {\r\n          console.log(\"[v0] No saved route data found for ID:\", routeId)\r\n          setPlannedRoute([])\r\n        }\r\n      } else {\r\n        console.log(\"[v0] No route ID set for circular route\")\r\n        setPlannedRoute([])\r\n      }\r\n    }\r\n\r\n    loadActiveRoute()\r\n  }, [isOperating, currentSchedule]) // Updated dependency to include currentSchedule\r\n\r\n  // ユーザーの現在位置を中心に\r\n  const handleUserLocation = useCallback(() => {\r\n    if (!map) return\r\n\r\n    if (userLocation) {\r\n      map.setView([userLocation.lat, userLocation.lng], 16)\r\n    } else {\r\n      if (\"geolocation\" in navigator) {\r\n        navigator.geolocation.getCurrentPosition(\r\n          (position) => {\r\n            const newLocation = {\r\n              lat: position.coords.latitude,\r\n              lng: position.coords.longitude,\r\n            }\r\n            setUserLocation(newLocation)\r\n            map.setView([newLocation.lat, newLocation.lng], 16)\r\n          },\r\n          (error) => {\r\n            console.error(\"[v0] Geolocation error:\", error.code, error.message)\r\n            if (error.code === 1) {\r\n              console.error(\"[v0] Location permission denied by user\")\r\n            } else if (error.code === 2) {\r\n              console.error(\"[v0] Location unavailable\")\r\n            } else if (error.code === 3) {\r\n              console.error(\"[v0] Location request timeout\")\r\n            }\r\n            alert(\"位置情報の取得に失敗しました\")\r\n          },\r\n        )\r\n      } else {\r\n        alert(\"このブラウザは位置情報に対応していません\")\r\n      }\r\n    }\r\n  }, [map, userLocation])\r\n\r\n  // 車両の現在位置を中心に\r\n  const handleVehicleLocation = useCallback(() => {\r\n    if (!map || locations.length === 0) {\r\n      console.log(\"[v0] Vehicle location not available\")\r\n      return\r\n    }\r\n\r\n    const latestLocation = locations[locations.length - 1]\r\n    console.log(\"[v0] Centering on vehicle:\", latestLocation)\r\n    map.setView([latestLocation.latitude, latestLocation.longitude], 16)\r\n  }, [map, locations])\r\n\r\n  return (\r\n    <main className=\"w-full h-screen relative overflow-hidden\">\r\n      <div className=\"absolute inset-0\" style={{ zIndex: 1 }}>\r\n        <MapWrapper\r\n          locations={locations}\r\n          onMapReady={setMap}\r\n          userLocation={userLocation}\r\n          plannedRoute={plannedRoute} // Simplified - route already controlled by useEffect\r\n        />\r\n      </div>\r\n\r\n      {!isOperating && nextOperation && (\r\n        <div\r\n          style={{\r\n            position: \"absolute\",\r\n            inset: 0,\r\n            backgroundColor: \"rgba(255, 255, 255, 0.85)\",\r\n            zIndex: 2,\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n            justifyContent: \"center\",\r\n            pointerEvents: \"none\",\r\n          }}\r\n        >\r\n          <div\r\n            style={{\r\n              textAlign: \"center\",\r\n              padding: \"32px\",\r\n              color: \"#000\",\r\n            }}\r\n          >\r\n            <div style={{ fontSize: \"20px\", fontWeight: \"500\", lineHeight: \"1.6\" }}>次回の運行は</div>\r\n            <div style={{ fontSize: \"24px\", fontWeight: \"700\", marginTop: \"8px\", lineHeight: \"1.4\" }}>\r\n              {nextOperation.date}({nextOperation.dayOfWeek})[{nextOperation.startTime}~{nextOperation.endTime}]\r\n            </div>\r\n            <div style={{ fontSize: \"20px\", fontWeight: \"500\", marginTop: \"8px\" }}>です</div>\r\n            <div style={{ fontSize: \"18px\", marginTop: \"16px\", color: \"#000\" }}>\r\n              スタート地点は{nextOperation.startLocation}です\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {isOperating && (\r\n        <div\r\n          style={{\r\n            position: \"fixed\",\r\n            top: \"16px\",\r\n            left: \"16px\",\r\n            zIndex: 9999,\r\n            pointerEvents: \"auto\",\r\n          }}\r\n        >\r\n          <PassengerCount />\r\n        </div>\r\n      )}\r\n\r\n      <div\r\n        style={{\r\n          position: \"fixed\",\r\n          top: \"16px\",\r\n          right: \"16px\",\r\n          zIndex: 9999,\r\n          pointerEvents: \"auto\",\r\n        }}\r\n      >\r\n        <ZoomControls map={map} onUserLocation={handleUserLocation} onVehicleLocation={handleVehicleLocation} />\r\n      </div>\r\n\r\n      {isOperating && (\r\n        <div\r\n          style={{\r\n            position: \"fixed\",\r\n            bottom: 0,\r\n            left: 0,\r\n            right: 0,\r\n            zIndex: 9999,\r\n            pointerEvents: \"auto\",\r\n          }}\r\n        >\r\n          <RouteInfo schedule={currentSchedule} isOperating={isOperating} />\r\n        </div>\r\n      )}\r\n    </main>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}