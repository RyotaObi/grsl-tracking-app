{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/components/map-wrapper.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport dynamic from \"next/dynamic\"\r\nimport type { LocationData } from \"@/lib/types\"\r\nimport type { Map as LeafletMap } from \"leaflet\"\r\n\r\ninterface MapProps {\r\n  locations: LocationData[]\r\n  plannedRoute?: [number, number][]\r\n  onMapReady?: (map: LeafletMap) => void\r\n  userLocation?: { lat: number; lng: number } | null\r\n}\r\n\r\nconst Map = dynamic(() => import(\"@/components/map\"), {\r\n  ssr: false,\r\n  loading: () => (\r\n    <div className=\"w-full h-full flex items-center justify-center bg-gray-100\">\r\n      <div className=\"text-gray-600\">地図を読み込んでいます...</div>\r\n    </div>\r\n  ),\r\n})\r\n\r\nexport function MapWrapper(props: MapProps) {\r\n  return <Map {...props} />\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;AAFA;;;AAaA,MAAM,MAAM,IAAA,0KAAO;;;;;;IACjB,KAAK;IACL,SAAS,kBACP,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BAAgB;;;;;;;;;;;;AAK9B,SAAS,WAAW,KAAe;IACxC,qBAAO,8OAAC;QAAK,GAAG,KAAK;;;;;;AACvB","debugId":null}},
    {"offset": {"line": 152, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/lib/utils/simplify-route.ts"],"sourcesContent":["// Douglas-Peucker アルゴリズムを使用してルートを簡略化\r\nexport function simplifyRoute(\r\n  points: { lat: number; lng: number }[],\r\n  tolerance = 0.0001,\r\n): { lat: number; lng: number }[] {\r\n  if (points.length <= 2) {\r\n    return points\r\n  }\r\n\r\n  // 最初と最後のポイントを結ぶ線からの最大距離を持つポイントを見つける\r\n  let maxDistance = 0\r\n  let maxIndex = 0\r\n  const start = points[0]\r\n  const end = points[points.length - 1]\r\n\r\n  for (let i = 1; i < points.length - 1; i++) {\r\n    const distance = perpendicularDistance(points[i], start, end)\r\n    if (distance > maxDistance) {\r\n      maxDistance = distance\r\n      maxIndex = i\r\n    }\r\n  }\r\n\r\n  // 最大距離がtoleranceより大きい場合、再帰的に分割\r\n  if (maxDistance > tolerance) {\r\n    const left = simplifyRoute(points.slice(0, maxIndex + 1), tolerance)\r\n    const right = simplifyRoute(points.slice(maxIndex), tolerance)\r\n\r\n    // 結合（中間のポイントを重複させないため、leftの最後を除く）\r\n    return [...left.slice(0, -1), ...right]\r\n  } else {\r\n    // toleranceより小さい場合、最初と最後のポイントだけを返す\r\n    return [start, end]\r\n  }\r\n}\r\n\r\n// ポイントから線分への垂直距離を計算\r\nfunction perpendicularDistance(\r\n  point: { lat: number; lng: number },\r\n  lineStart: { lat: number; lng: number },\r\n  lineEnd: { lat: number; lng: number },\r\n): number {\r\n  const x = point.lng\r\n  const y = point.lat\r\n  const x1 = lineStart.lng\r\n  const y1 = lineStart.lat\r\n  const x2 = lineEnd.lng\r\n  const y2 = lineEnd.lat\r\n\r\n  const A = x - x1\r\n  const B = y - y1\r\n  const C = x2 - x1\r\n  const D = y2 - y1\r\n\r\n  const dot = A * C + B * D\r\n  const lenSq = C * C + D * D\r\n\r\n  let param = -1\r\n  if (lenSq !== 0) {\r\n    param = dot / lenSq\r\n  }\r\n\r\n  let xx, yy\r\n\r\n  if (param < 0) {\r\n    xx = x1\r\n    yy = y1\r\n  } else if (param > 1) {\r\n    xx = x2\r\n    yy = y2\r\n  } else {\r\n    xx = x1 + param * C\r\n    yy = y1 + param * D\r\n  }\r\n\r\n  const dx = x - xx\r\n  const dy = y - yy\r\n\r\n  return Math.sqrt(dx * dx + dy * dy)\r\n}\r\n\r\n// 重複ポイントを削除（GPSの精度による微小な揺れを除去）\r\nexport function removeDuplicatePoints(\r\n  points: { lat: number; lng: number }[],\r\n  minDistance = 0.00001, // 約1メートル\r\n): { lat: number; lng: number }[] {\r\n  if (points.length <= 1) {\r\n    return points\r\n  }\r\n\r\n  const result: { lat: number; lng: number }[] = [points[0]]\r\n\r\n  for (let i = 1; i < points.length; i++) {\r\n    const prev = result[result.length - 1]\r\n    const curr = points[i]\r\n\r\n    const distance = Math.sqrt(Math.pow(curr.lat - prev.lat, 2) + Math.pow(curr.lng - prev.lng, 2))\r\n\r\n    if (distance >= minDistance) {\r\n      result.push(curr)\r\n    }\r\n  }\r\n\r\n  return result\r\n}\r\n\r\nexport async function snapToRoads(\r\n  points: { lat: number; lng: number }[],\r\n): Promise<{ lat: number; lng: number }[] | null> {\r\n  try {\r\n    // OSRM has a limit of 100 points per request\r\n    // First simplify to reduce points if necessary\r\n    let processedPoints = points\r\n    if (points.length > 100) {\r\n      processedPoints = simplifyRoute(points, 0.0002) // More aggressive simplification\r\n      console.log(`[v0] Reduced points for OSRM: ${points.length} → ${processedPoints.length}`)\r\n    }\r\n\r\n    // Format coordinates for OSRM: \"lng,lat;lng,lat;...\"\r\n    const coordinates = processedPoints.map((p) => `${p.lng},${p.lat}`).join(\";\")\r\n\r\n    // Call OSRM Map Matching API\r\n    const url = `https://router.project-osrm.org/match/v1/driving/${coordinates}?overview=full&geometries=geojson`\r\n\r\n    console.log(`[v0] Calling OSRM Map Matching API with ${processedPoints.length} points...`)\r\n\r\n    const response = await fetch(url)\r\n    if (!response.ok) {\r\n      throw new Error(`OSRM API error: ${response.status}`)\r\n    }\r\n\r\n    const data = await response.json()\r\n\r\n    if (data.code !== \"Ok\" || !data.matchings || data.matchings.length === 0) {\r\n      console.error(\"[v0] OSRM matching failed:\", data.message)\r\n      return null\r\n    }\r\n\r\n    // Extract matched coordinates\r\n    const matchedCoordinates = data.matchings[0].geometry.coordinates.map((coord: [number, number]) => ({\r\n      lng: coord[0],\r\n      lat: coord[1],\r\n    }))\r\n\r\n    console.log(`[v0] OSRM Map Matching successful: ${processedPoints.length} → ${matchedCoordinates.length} points`)\r\n\r\n    return matchedCoordinates\r\n  } catch (error) {\r\n    console.error(\"[v0] Error in road snapping:\", error)\r\n    return null\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 283, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/lib/firebase.ts"],"sourcesContent":["import { initializeApp, getApps } from \"firebase/app\"\r\nimport {\r\n  getFirestore,\r\n  collection,\r\n  query,\r\n  orderBy,\r\n  onSnapshot,\r\n  Timestamp,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  setDoc,\r\n} from \"firebase/firestore\"\r\nimport type { LocationData, SavedRoute, ActiveRouteSettings } from \"./types\"\r\nimport { simplifyRoute, removeDuplicatePoints, snapToRoads } from \"./utils/simplify-route\"\r\n\r\nconst firebaseConfig = {\r\n  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\r\n  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\r\n  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\r\n  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\r\n  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\r\n  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\r\n  measurementId: process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID,\r\n}\r\n\r\n// Initialize Firebase (singleton pattern)\r\nconst app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0]\r\nconst db = getFirestore(app)\r\n\r\nexport { app, db }\r\n\r\nexport function getRealtimeLocations(\r\n  collectionName: string,\r\n  callback: (locations: LocationData[]) => void,\r\n): () => void {\r\n  const locationsRef = collection(db, collectionName)\r\n  const q = query(locationsRef, orderBy(\"timestamp\", \"asc\"))\r\n\r\n  const unsubscribe = onSnapshot(\r\n    q,\r\n    (snapshot) => {\r\n      const locations: LocationData[] = []\r\n      snapshot.forEach((doc) => {\r\n        const data = doc.data()\r\n        locations.push({\r\n          id: doc.id,\r\n          latitude: data.latitude,\r\n          longitude: data.longitude,\r\n          timestamp: data.timestamp instanceof Timestamp ? data.timestamp.toDate() : new Date(data.timestamp),\r\n          speed: data.speed,\r\n          accuracy: data.accuracy,\r\n        })\r\n      })\r\n      callback(locations)\r\n    },\r\n    (error) => {\r\n      console.error(\"[v0] Firestore error:\", error)\r\n    },\r\n  )\r\n\r\n  return unsubscribe\r\n}\r\n\r\nexport async function getActiveRoute(): Promise<string | null> {\r\n  try {\r\n    const docRef = doc(db, \"settings\", \"active-route\")\r\n    const docSnap = await getDoc(docRef)\r\n\r\n    if (docSnap.exists()) {\r\n      const data = docSnap.data() as ActiveRouteSettings\r\n      return data.routeId\r\n    }\r\n    return null\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting active route:\", error)\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function getSavedRoute(routeId: string): Promise<SavedRoute | null> {\r\n  try {\r\n    const docRef = doc(db, \"saved-routes\", routeId)\r\n    const docSnap = await getDoc(docRef)\r\n\r\n    if (docSnap.exists()) {\r\n      return docSnap.data() as SavedRoute\r\n    }\r\n    return null\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting saved route:\", error)\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function getDateCollections(): Promise<string[]> {\r\n  try {\r\n    const docRef = doc(db, \"date-index\", \"dates\")\r\n    const docSnap = await getDoc(docRef)\r\n\r\n    if (docSnap.exists()) {\r\n      const data = docSnap.data()\r\n      const dateList = data.dateList as string[]\r\n\r\n      // Sort by date descending (newest first)\r\n      return dateList.sort((a, b) => {\r\n        const dateA = a.split(\"_\")[0]\r\n        const dateB = b.split(\"_\")[0]\r\n        return dateB.localeCompare(dateA)\r\n      })\r\n    }\r\n\r\n    return []\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting date index:\", error)\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function getAllLocationsFromCollection(collectionName: string): Promise<LocationData[]> {\r\n  try {\r\n    const locationsRef = collection(db, collectionName)\r\n    const q = query(locationsRef, orderBy(\"timestamp\", \"asc\"))\r\n    const snapshot = await getDocs(q)\r\n\r\n    const locations: LocationData[] = []\r\n    snapshot.forEach((doc) => {\r\n      const data = doc.data()\r\n      locations.push({\r\n        id: doc.id,\r\n        latitude: data.latitude,\r\n        longitude: data.longitude,\r\n        timestamp: data.timestamp instanceof Timestamp ? data.timestamp.toDate() : new Date(data.timestamp),\r\n        speed: data.speed,\r\n        accuracy: data.accuracy,\r\n      })\r\n    })\r\n\r\n    return locations\r\n  } catch (error) {\r\n    console.error(\"[v0] Error getting locations from collection:\", error)\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function saveRouteAsActive(routeId: string, locations: LocationData[]): Promise<boolean> {\r\n  try {\r\n    const points = locations.map((loc) => ({\r\n      lat: loc.latitude,\r\n      lng: loc.longitude,\r\n      timestamp: loc.timestamp instanceof Date ? loc.timestamp.toISOString() : loc.timestamp,\r\n    }))\r\n\r\n    const deduplicated = removeDuplicatePoints(points)\r\n    console.log(`[v0] Step 1 - Deduplication: ${points.length} → ${deduplicated.length} points`)\r\n\r\n    const snapped = await snapToRoads(deduplicated)\r\n\r\n    let finalPoints: { lat: number; lng: number }[]\r\n\r\n    if (snapped) {\r\n      console.log(`[v0] Step 2 - Road snapping successful: ${snapped.length} points`)\r\n      finalPoints = snapped\r\n    } else {\r\n      console.log(\"[v0] Step 2 - Road snapping failed, using Douglas-Peucker instead\")\r\n      const simplified = simplifyRoute(deduplicated, 0.0001)\r\n      console.log(`[v0] Step 2 - Simplification: ${deduplicated.length} → ${simplified.length} points`)\r\n      finalPoints = simplified\r\n    }\r\n\r\n    // Save route data to /saved-routes/{routeId}\r\n    const routeDocRef = doc(db, \"saved-routes\", routeId)\r\n    const savedRoute: SavedRoute = {\r\n      name: `${routeId}のルート`,\r\n      createdAt: new Date().toISOString(),\r\n      points: finalPoints,\r\n    }\r\n    await setDoc(routeDocRef, savedRoute)\r\n\r\n    // Update /settings/active-route to point to this route\r\n    const settingsDocRef = doc(db, \"settings\", \"active-route\")\r\n    const activeSettings: ActiveRouteSettings = {\r\n      routeId: routeId,\r\n      updatedAt: new Date().toISOString(),\r\n    }\r\n    await setDoc(settingsDocRef, activeSettings)\r\n\r\n    return true\r\n  } catch (error) {\r\n    console.error(\"[v0] Error saving route:\", error)\r\n    return false\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 459, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Documents/my-app/app/operator/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useState } from \"react\"\r\nimport { MapWrapper } from \"@/components/map-wrapper\"\r\nimport { getDateCollections, getAllLocationsFromCollection, saveRouteAsActive } from \"@/lib/firebase\"\r\nimport type { LocationData } from \"@/lib/types\"\r\nimport { ChevronLeft, ChevronRight, Check } from \"lucide-react\"\r\n\r\nexport default function OperatorPage() {\r\n  const [dateCollections, setDateCollections] = useState<string[]>([])\r\n  const [currentIndex, setCurrentIndex] = useState(0)\r\n  const [locations, setLocations] = useState<LocationData[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [saving, setSaving] = useState(false)\r\n  const [message, setMessage] = useState(\"\")\r\n\r\n  // Load date collections on mount\r\n  useEffect(() => {\r\n    async function loadDateCollections() {\r\n      console.log(\"[v0] Loading date collections...\")\r\n      const collections = await getDateCollections()\r\n      console.log(\"[v0] Found collections:\", collections)\r\n      setDateCollections(collections)\r\n      setLoading(false)\r\n    }\r\n    loadDateCollections()\r\n  }, [])\r\n\r\n  // Load locations when date changes\r\n  useEffect(() => {\r\n    if (dateCollections.length > 0) {\r\n      loadLocationsForCurrentDate()\r\n    }\r\n  }, [currentIndex, dateCollections])\r\n\r\n  async function loadLocationsForCurrentDate() {\r\n    if (dateCollections.length === 0) return\r\n\r\n    const collectionName = dateCollections[currentIndex]\r\n    console.log(\"[v0] Loading locations for:\", collectionName)\r\n\r\n    setLoading(true)\r\n    const locs = await getAllLocationsFromCollection(collectionName)\r\n    console.log(\"[v0] Loaded locations:\", locs.length)\r\n    setLocations(locs)\r\n    setLoading(false)\r\n  }\r\n\r\n  function handlePrevious() {\r\n    if (currentIndex < dateCollections.length - 1) {\r\n      setCurrentIndex(currentIndex + 1)\r\n      setMessage(\"\")\r\n    }\r\n  }\r\n\r\n  function handleNext() {\r\n    if (currentIndex > 0) {\r\n      setCurrentIndex(currentIndex - 1)\r\n      setMessage(\"\")\r\n    }\r\n  }\r\n\r\n  async function handleSetRoute() {\r\n    if (dateCollections.length === 0 || locations.length === 0) return\r\n\r\n    setSaving(true)\r\n    setMessage(\"\")\r\n\r\n    const routeId = dateCollections[currentIndex]\r\n    const success = await saveRouteAsActive(routeId, locations)\r\n\r\n    if (success) {\r\n      setMessage(`${routeId}のルートを設定しました`)\r\n    } else {\r\n      setMessage(\"ルートの設定に失敗しました\")\r\n    }\r\n\r\n    setSaving(false)\r\n  }\r\n\r\n  const currentDate = dateCollections[currentIndex]\r\n  const formattedDate = currentDate\r\n    ? `${currentDate.slice(0, 4)}年${currentDate.slice(4, 6)}月${currentDate.slice(6, 8)}日`\r\n    : \"\"\r\n\r\n  // Convert locations to route coordinates\r\n  const routeCoordinates: [number, number][] = locations.map((loc) => [loc.latitude, loc.longitude])\r\n\r\n  if (loading && dateCollections.length === 0) {\r\n    return (\r\n      <div className=\"w-screen h-screen flex items-center justify-center bg-gray-100\">\r\n        <div className=\"text-gray-600\">読み込み中...</div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (dateCollections.length === 0) {\r\n    return (\r\n      <div className=\"w-screen h-screen flex items-center justify-center bg-gray-100\">\r\n        <div className=\"text-gray-600\">走行記録がありません</div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div style={{ width: \"100vw\", height: \"100vh\", position: \"relative\" }}>\r\n      {/* Map */}\r\n      <MapWrapper locations={[]} plannedRoute={routeCoordinates} />\r\n\r\n      {/* Header */}\r\n      <div\r\n        style={{\r\n          position: \"fixed\",\r\n          top: 16,\r\n          left: 16,\r\n          right: 16,\r\n          zIndex: 1000,\r\n          display: \"flex\",\r\n          justifyContent: \"center\",\r\n        }}\r\n      >\r\n        <div\r\n          style={{\r\n            backgroundColor: \"rgba(255, 255, 255, 0.95)\",\r\n            borderRadius: 16,\r\n            padding: \"16px 24px\",\r\n            boxShadow: \"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)\",\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n            gap: 16,\r\n          }}\r\n        >\r\n          <button\r\n            onClick={handlePrevious}\r\n            disabled={currentIndex >= dateCollections.length - 1}\r\n            style={{\r\n              width: 48,\r\n              height: 48,\r\n              borderRadius: 9999,\r\n              backgroundColor: currentIndex >= dateCollections.length - 1 ? \"#e5e7eb\" : \"#3b82f6\",\r\n              color: \"white\",\r\n              border: \"none\",\r\n              cursor: currentIndex >= dateCollections.length - 1 ? \"not-allowed\" : \"pointer\",\r\n              display: \"flex\",\r\n              alignItems: \"center\",\r\n              justifyContent: \"center\",\r\n              transition: \"all 0.2s\",\r\n            }}\r\n          >\r\n            <ChevronLeft size={24} />\r\n          </button>\r\n\r\n          <div style={{ textAlign: \"center\", minWidth: 200 }}>\r\n            <div style={{ fontSize: 18, fontWeight: 700, color: \"#1f2937\" }}>{formattedDate}</div>\r\n            <div style={{ fontSize: 14, color: \"#6b7280\", marginTop: 4 }}>{locations.length}ポイント</div>\r\n          </div>\r\n\r\n          <button\r\n            onClick={handleNext}\r\n            disabled={currentIndex === 0}\r\n            style={{\r\n              width: 48,\r\n              height: 48,\r\n              borderRadius: 9999,\r\n              backgroundColor: currentIndex === 0 ? \"#e5e7eb\" : \"#3b82f6\",\r\n              color: \"white\",\r\n              border: \"none\",\r\n              cursor: currentIndex === 0 ? \"not-allowed\" : \"pointer\",\r\n              display: \"flex\",\r\n              alignItems: \"center\",\r\n              justifyContent: \"center\",\r\n              transition: \"all 0.2s\",\r\n            }}\r\n          >\r\n            <ChevronRight size={24} />\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Set Route Button */}\r\n      <div\r\n        style={{\r\n          position: \"fixed\",\r\n          bottom: 16,\r\n          left: \"50%\",\r\n          transform: \"translateX(-50%)\",\r\n          zIndex: 1000,\r\n        }}\r\n      >\r\n        <button\r\n          onClick={handleSetRoute}\r\n          disabled={saving || locations.length === 0}\r\n          style={{\r\n            backgroundColor: saving || locations.length === 0 ? \"#9ca3af\" : \"#10b981\",\r\n            color: \"white\",\r\n            padding: \"16px 32px\",\r\n            borderRadius: 16,\r\n            border: \"none\",\r\n            fontSize: 16,\r\n            fontWeight: 700,\r\n            cursor: saving || locations.length === 0 ? \"not-allowed\" : \"pointer\",\r\n            boxShadow: \"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)\",\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n            gap: 8,\r\n            transition: \"all 0.2s\",\r\n          }}\r\n        >\r\n          <Check size={20} />\r\n          {saving ? \"設定中...\" : \"このルートを設定\"}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Message */}\r\n      {message && (\r\n        <div\r\n          style={{\r\n            position: \"fixed\",\r\n            top: 100,\r\n            left: \"50%\",\r\n            transform: \"translateX(-50%)\",\r\n            zIndex: 1001,\r\n            backgroundColor: \"rgba(16, 185, 129, 0.95)\",\r\n            color: \"white\",\r\n            padding: \"12px 24px\",\r\n            borderRadius: 12,\r\n            fontSize: 14,\r\n            fontWeight: 600,\r\n            boxShadow: \"0 4px 6px -1px rgba(0, 0, 0, 0.1)\",\r\n          }}\r\n        >\r\n          {message}\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AANA;;;;;;AAQe,SAAS;IACtB,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,iNAAQ,EAAW,EAAE;IACnE,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IACjD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAiB,EAAE;IAC7D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IACrC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,iCAAiC;IACjC,IAAA,kNAAS,EAAC;QACR,eAAe;YACb,QAAQ,GAAG,CAAC;YACZ,MAAM,cAAc,MAAM,IAAA,qIAAkB;YAC5C,QAAQ,GAAG,CAAC,2BAA2B;YACvC,mBAAmB;YACnB,WAAW;QACb;QACA;IACF,GAAG,EAAE;IAEL,mCAAmC;IACnC,IAAA,kNAAS,EAAC;QACR,IAAI,gBAAgB,MAAM,GAAG,GAAG;YAC9B;QACF;IACF,GAAG;QAAC;QAAc;KAAgB;IAElC,eAAe;QACb,IAAI,gBAAgB,MAAM,KAAK,GAAG;QAElC,MAAM,iBAAiB,eAAe,CAAC,aAAa;QACpD,QAAQ,GAAG,CAAC,+BAA+B;QAE3C,WAAW;QACX,MAAM,OAAO,MAAM,IAAA,gJAA6B,EAAC;QACjD,QAAQ,GAAG,CAAC,0BAA0B,KAAK,MAAM;QACjD,aAAa;QACb,WAAW;IACb;IAEA,SAAS;QACP,IAAI,eAAe,gBAAgB,MAAM,GAAG,GAAG;YAC7C,gBAAgB,eAAe;YAC/B,WAAW;QACb;IACF;IAEA,SAAS;QACP,IAAI,eAAe,GAAG;YACpB,gBAAgB,eAAe;YAC/B,WAAW;QACb;IACF;IAEA,eAAe;QACb,IAAI,gBAAgB,MAAM,KAAK,KAAK,UAAU,MAAM,KAAK,GAAG;QAE5D,UAAU;QACV,WAAW;QAEX,MAAM,UAAU,eAAe,CAAC,aAAa;QAC7C,MAAM,UAAU,MAAM,IAAA,oIAAiB,EAAC,SAAS;QAEjD,IAAI,SAAS;YACX,WAAW,GAAG,QAAQ,WAAW,CAAC;QACpC,OAAO;YACL,WAAW;QACb;QAEA,UAAU;IACZ;IAEA,MAAM,cAAc,eAAe,CAAC,aAAa;IACjD,MAAM,gBAAgB,cAClB,GAAG,YAAY,KAAK,CAAC,GAAG,GAAG,CAAC,EAAE,YAAY,KAAK,CAAC,GAAG,GAAG,CAAC,EAAE,YAAY,KAAK,CAAC,GAAG,GAAG,CAAC,CAAC,GACnF;IAEJ,yCAAyC;IACzC,MAAM,mBAAuC,UAAU,GAAG,CAAC,CAAC,MAAQ;YAAC,IAAI,QAAQ;YAAE,IAAI,SAAS;SAAC;IAEjG,IAAI,WAAW,gBAAgB,MAAM,KAAK,GAAG;QAC3C,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BAAgB;;;;;;;;;;;IAGrC;IAEA,IAAI,gBAAgB,MAAM,KAAK,GAAG;QAChC,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BAAgB;;;;;;;;;;;IAGrC;IAEA,qBACE,8OAAC;QAAI,OAAO;YAAE,OAAO;YAAS,QAAQ;YAAS,UAAU;QAAW;;0BAElE,8OAAC,2IAAU;gBAAC,WAAW,EAAE;gBAAE,cAAc;;;;;;0BAGzC,8OAAC;gBACC,OAAO;oBACL,UAAU;oBACV,KAAK;oBACL,MAAM;oBACN,OAAO;oBACP,QAAQ;oBACR,SAAS;oBACT,gBAAgB;gBAClB;0BAEA,cAAA,8OAAC;oBACC,OAAO;wBACL,iBAAiB;wBACjB,cAAc;wBACd,SAAS;wBACT,WAAW;wBACX,SAAS;wBACT,YAAY;wBACZ,KAAK;oBACP;;sCAEA,8OAAC;4BACC,SAAS;4BACT,UAAU,gBAAgB,gBAAgB,MAAM,GAAG;4BACnD,OAAO;gCACL,OAAO;gCACP,QAAQ;gCACR,cAAc;gCACd,iBAAiB,gBAAgB,gBAAgB,MAAM,GAAG,IAAI,YAAY;gCAC1E,OAAO;gCACP,QAAQ;gCACR,QAAQ,gBAAgB,gBAAgB,MAAM,GAAG,IAAI,gBAAgB;gCACrE,SAAS;gCACT,YAAY;gCACZ,gBAAgB;gCAChB,YAAY;4BACd;sCAEA,cAAA,8OAAC,mOAAW;gCAAC,MAAM;;;;;;;;;;;sCAGrB,8OAAC;4BAAI,OAAO;gCAAE,WAAW;gCAAU,UAAU;4BAAI;;8CAC/C,8OAAC;oCAAI,OAAO;wCAAE,UAAU;wCAAI,YAAY;wCAAK,OAAO;oCAAU;8CAAI;;;;;;8CAClE,8OAAC;oCAAI,OAAO;wCAAE,UAAU;wCAAI,OAAO;wCAAW,WAAW;oCAAE;;wCAAI,UAAU,MAAM;wCAAC;;;;;;;;;;;;;sCAGlF,8OAAC;4BACC,SAAS;4BACT,UAAU,iBAAiB;4BAC3B,OAAO;gCACL,OAAO;gCACP,QAAQ;gCACR,cAAc;gCACd,iBAAiB,iBAAiB,IAAI,YAAY;gCAClD,OAAO;gCACP,QAAQ;gCACR,QAAQ,iBAAiB,IAAI,gBAAgB;gCAC7C,SAAS;gCACT,YAAY;gCACZ,gBAAgB;gCAChB,YAAY;4BACd;sCAEA,cAAA,8OAAC,sOAAY;gCAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;0BAM1B,8OAAC;gBACC,OAAO;oBACL,UAAU;oBACV,QAAQ;oBACR,MAAM;oBACN,WAAW;oBACX,QAAQ;gBACV;0BAEA,cAAA,8OAAC;oBACC,SAAS;oBACT,UAAU,UAAU,UAAU,MAAM,KAAK;oBACzC,OAAO;wBACL,iBAAiB,UAAU,UAAU,MAAM,KAAK,IAAI,YAAY;wBAChE,OAAO;wBACP,SAAS;wBACT,cAAc;wBACd,QAAQ;wBACR,UAAU;wBACV,YAAY;wBACZ,QAAQ,UAAU,UAAU,MAAM,KAAK,IAAI,gBAAgB;wBAC3D,WAAW;wBACX,SAAS;wBACT,YAAY;wBACZ,KAAK;wBACL,YAAY;oBACd;;sCAEA,8OAAC,6MAAK;4BAAC,MAAM;;;;;;wBACZ,SAAS,WAAW;;;;;;;;;;;;YAKxB,yBACC,8OAAC;gBACC,OAAO;oBACL,UAAU;oBACV,KAAK;oBACL,MAAM;oBACN,WAAW;oBACX,QAAQ;oBACR,iBAAiB;oBACjB,OAAO;oBACP,SAAS;oBACT,cAAc;oBACd,UAAU;oBACV,YAAY;oBACZ,WAAW;gBACb;0BAEC;;;;;;;;;;;;AAKX","debugId":null}}]
}